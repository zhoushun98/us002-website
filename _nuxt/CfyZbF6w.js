import{c as f,b as w,d as I,a as D,e as _,u as P,n as T,_ as d,f as h}from"./DBm9bF5s.js";import{u as y,_ as U}from"./ChSu0X3P.js";import{q as b,at as C,w as L,H as v,R,Z as O,b as A,S,a4 as k,j as B,Q as E}from"./C-fWFG71.js";import{u as M}from"./w1_APCHV.js";function V(n){const i=n.title,l=n.metaDescription||f.META.DESCRIPTION;let e=w(f.IMAGES.OG);if(n.featureImage){const a=I()(n.featureImage,{enlarge:!0,width:1200,height:630,format:"png",fit:"cover",quality:85});e=w(a)}const m=e,g=n.metaTitle||i,t=n.metaDescription||l,p=e,o=g,s=t;D({title:i,titleTemplate:"%s",meta:[{name:"description",content:l},{property:"og:image",content:m},{property:"og:title",content:g},{property:"og:description",content:t},{name:"twitter:site",content:_.TWITTER.HANDLE},{name:"twitter:creator",content:_.TWITTER.HANDLE},{name:"twitter:image",content:p},{name:"twitter:title",content:o},{name:"twitter:description",content:s}]})}const G={class:"blog-container"},K=b({__name:"[slug]",async setup(n){var p;let i,l;const e=B(),m=P(),g=y(),{data:t}=([i,l]=C(async()=>M(`getPostCmsData${m.params.slug}`,async()=>{const{cmsClient:o}=await d(async()=>{const{cmsClient:u}=await import("bts-blog-cms-client");return{cmsClient:u}},[],import.meta.url),s=await o({ghostUrl:e.public.ghostUrl,ghostKey:e.public.ghostPublicApiKey,ghostVersion:e.public.ghostApiVersion,oldUrl:e.oldUrl,newUrl:e.newUrl,oldImageUrl:e.oldImageUrl,newImageUrl:e.newImageUrl,useCache:e.useCache});await s.getAllPosts();const{addAdditionalAttributesToLinks:r}=await d(async()=>{const{addAdditionalAttributesToLinks:u}=await import("bts-dom-server-utils");return{addAdditionalAttributesToLinks:u}},[],import.meta.url),a=(await d(async()=>{const{default:u}=await import("sanitize-html");return{default:u}},[],import.meta.url)).default,c=s.cachedPosts[m.params.slug];if(c.html=a(r(c.html??"",e.whitelistedDomains),{allowedTags:_.POST.ALLOWED_TAGS,allowedAttributes:_.POST.ALLOWED_ATTRIBUTES}),!c)throw h({statusCode:404,statusMessage:"Page Not Found"});return{post:s.getPostListFields(c,!1)}})),i=await i,l(),i);return L(()=>{var o,s,r,a;if(e.public.isGenerateMode&&!((s=(o=t==null?void 0:t.value)==null?void 0:o.post)!=null&&s.tags))throw h({statusCode:404,message:"Page not found",fatal:!0});g.isPostBlocked((a=(r=t==null?void 0:t.value)==null?void 0:r.post)==null?void 0:a.tags)&&T("/404")}),(p=t==null?void 0:t.value)!=null&&p.post&&V(t.value.post),v(()=>{var o;e.public.isGenerateMode&&!((o=t==null?void 0:t.value)!=null&&o.post)&&T("/404")}),(o,s)=>{var a,c;const r=U;return E(),R("div",null,[O("div",G,[(a=A(t))!=null&&a.post?(E(),S(r,{key:0,post:(c=A(t))==null?void 0:c.post,"preload-image":""},null,8,["post"])):k("",!0)])])}}});export{K as default};
