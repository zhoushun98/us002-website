/*!
 * IMPORTANT NOTE:
 * 
 *   This file is licensed only for the use of Apple developers in providing MusicKit Web Services,
 *   and is subject to the Apple Media Services Terms and Conditions and the Apple Developer Program
 *   License Agreement. You may not copy, modify, re-host, or create derivative works of this file or the
 *   accompanying Documentation, or any part thereof, including any updates, without Apple's written consent.
 * 
 *   ACKNOWLEDGEMENTS:
 *   /musickit/v1/acknowledgements.txt
 */
import{c as t,a as n}from"./p-2649b6ee.js";import{s as e,f as i}from"./p-bb5da73d.js";import{u as r}from"./p-9d409825.js";import{j as o}from"./p-e6747c77.js";import{n as s}from"./p-a0c067db.js";var u=t((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.camelize=void 0,n.camelize=t=>t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,n)=>n.toUpperCase()))})),a=t((function(t,n){function e(t,n){return Object.prototype.hasOwnProperty.call(Object(t),n)}function i(t){const n=Object.prototype.toString.call(t).toLowerCase().slice(8,-1);switch(n){case"set":return new Set([...t].map((t=>i(t))));case"map":return new Map([...t].map((([t,n])=>[i(t),i(n)])));case"date":return new Date(t.getTime());case"regexp":{const n=t,e="string"==typeof n.flags?n.flags:[n.global?"g":void 0,n.ignoreCase?"i":void 0,n.multiline?"m":void 0,n.sticky?"y":void 0,n.unicode?"u":void 0].filter((t=>void 0!==t)).join("");return RegExp(t.source,e)}case"arraybuffer":{const n=t;if("function"==typeof n.slice)return n.slice(0);{const e=new t.constructor(n.byteLength);return new Uint8Array(e).set(new Uint8Array(n)),e}}case"dataview":case"int8array":case"uint8array":case"uint8clampedarray":case"int16array":case"uint16array":case"int32array":case"uint32array":case"float32array":case"float64array":case"bigint64array":case"biguint64array":{const e=t;return new(0,e.constructor)(i(e.buffer),e.byteOffset,"dataview"===n?e.byteLength:e.length)}case"array":case"object":{const n=Array.isArray(t)?[]:{};for(const r in t)e(t,r)&&(n[r]=i(t[r]));return n}default:return t}}function r(t,n){return n.split(".").reduce(((t,n)=>{if(void 0!==t)return t[n]}),t)}function o(t,n,i){return n.split(".").reduce(((n,r,o,s)=>{const u=o===s.length-1,a=e(n,r);if(!u&&a&&(!(n[r]instanceof Object)||null===n[r]))throw new TypeError(`Value at ${s.slice(0,o+1).join(".")} in keypath is not an Object.`);return u?(n[r]=i,t):a?n[r]:n[r]={}}),t)}Object.defineProperty(n,"__esModule",{value:!0}),n.deepAssign=n.transformKeys=n.transform=n.set=n.isEmpty=n.get=n.deepClone=n.hasOwn=void 0,n.hasOwn=e,n.deepClone=i,n.get=r,n.isEmpty=function(t){if("object"!=typeof t)throw new TypeError("Source is not an Object");for(const n in t)if(e(t,n))return!1;return!0},n.set=o,n.transform=function(t,n,e=!1){return e&&(t=Object.keys(t).reduce(((n,e)=>(n[t[e]]=e,n)),{})),Object.keys(t).reduce(((e,i)=>{const s=t[i],u="function"==typeof s?s():r(n,s);return u&&o(e,i,u),e}),{})},n.transformKeys=function(t,n){return Object.keys(t).reduce(((e,i)=>(e[n(i)]=t[i],e)),{})},n.deepAssign=(...t)=>{if(t.length<=1)return t[0];const[e,r,...o]=t;return Object.keys(r).forEach((t=>{const o=r[t];"object"!=typeof o?e[t]=o:Array.isArray(o)||!(t in e)?e[t]=i(o):(0,n.deepAssign)(e[t],o)})),(0,n.deepAssign)(e,...o)}})),c=t((function(t,n){function i(t,e){const i=(0,u.camelize)(t);if((0,a.hasOwn)(n.devFlags,i)){const r=n.devFlags[i];if(e!==r.constructor)throw new Error(`DevFlag ${t} was already registered with a different type (${r.constructor.name})`);return r}const r=new e(t);return Object.defineProperty(n.devFlags,i,{configurable:!0,enumerable:!0,get:function(){return r},set(t){r.set(t)}}),r}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonDevFlag=n.BooleanDevFlag=n.NumberDevFlag=n.StringDevFlag=n.LocalStorageDevFlag=n.devFlags=void 0,n.devFlags={};class r{constructor(t){if("string"!=typeof t||""===t.trim())throw new Error("DevFlag requires a non-empty string key");this.key=t}get value(){return this.get()}get configured(){return void 0!==this.value}read(){var t,n;const i=null!==(n=null===(t=(0,e.getLocalStorage)())||void 0===t?void 0:t.getItem(this.key))&&void 0!==n?n:null;return null!==i?i:void 0}write(t){var n;null===(n=(0,e.getLocalStorage)())||void 0===n||n.setItem(this.key,t)}clear(){var t;null===(t=(0,e.getLocalStorage)())||void 0===t||t.removeItem(this.key)}}n.LocalStorageDevFlag=r,n.StringDevFlag=class extends r{static register(t){return i(t,this)}static get(t){return this.register(t).get()}static set(t,n){this.register(t).set(n)}get(){return this.read()}set(t){"string"!=typeof t&&console.warn("Value for StringDevFlag should be a string"),this.write(t)}},n.NumberDevFlag=class extends r{static register(t){return i(t,this)}static get(t){return this.register(t).get()}static set(t,n){this.register(t).set(n)}get(){const t=this.read();return void 0!==t?Number(t):void 0}set(t){"number"==typeof t?this.write(String(t)):console.warn("Value for NumberDevFlag should be a number")}},n.BooleanDevFlag=class extends r{static register(t){return i(t,this)}static get(t){return this.register(t).get()}static set(t,n){this.register(t).set(n)}get(){const t=this.read();if(void 0!==t)return"1"===t||"true"===t.toLowerCase()}set(t){"boolean"==typeof t?this.write(!0===t?"1":"0"):console.warn("Value for BooleanDevFlag should be a boolean")}get enabled(){return!0===this.get()}enable(){this.set(!0)}disable(){this.set(!1)}toggle(){this.set(!this.get())}},n.JsonDevFlag=class extends r{static register(t){return i(t,this)}static get(t){return this.register(t).get()}static set(t,n){this.register(t).set(n)}get(){const t=this.read();if(void 0!==t)try{return JSON.parse(t)}catch(n){return}}set(t){this.write(JSON.stringify(t))}prop(t){if(void 0!==this.value)return this.value[t]}}})),f=t((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.mkHlsJsAutomationConfigHelper=void 0,n.mkHlsJsAutomationConfigHelper=c.JsonDevFlag.register("mk-hlsjs-automation-config")})),l=t((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.loadScript=n.loadScriptReset=n.cdnBaseURL=n.isAppleHostname=n.getHlsJsCdnConfig=n.determineHlsJsBuild=n.mkHlsJsLogLevelHelper=n.determineCdnPathHost=n.determineCdnBaseHost=n.determineCdnPathPrefix=n.determineCdnBasePrefix=n.getScriptSrcElements=n.findScript=n.HLSJS_VERSION=n.DEFAULT_CDN_PATH=void 0;const i="";n.DEFAULT_CDN_PATH="/musickit/v3/",n.HLSJS_VERSION="2.610.3";const o=new RegExp(`^https://([a-z0-9]+-)?${(i+n.DEFAULT_CDN_PATH.replace(/v3/,"(v2|v3)")).replace(/[\.\/]/g,"\\$&")}`,"i"),s=/^https:\/\/(.*\/includes\/js-cdn)\//i,u=/^([a-z]+:)?\/\//;function a(t){return(0,r.isNodeEnvironment)()||!t?null:document.querySelector(`script[src*="${t}"]`)}function l(){return"undefined"!=typeof document&&document.querySelectorAll?Array.from(document.querySelectorAll("script[src]")):[]}function h(){for(const t of l()){const n=o.exec(t.src);if(n)return n[1]||""}return""}function d(){for(const t of l()){const n=s.exec(t.src);if(n)return n[1]||""}return""}function v(){return(0,r.isNodeEnvironment)()?"":`//${h()}${i}`}function p(){const t=d();return t?"//"+t:t}n.findScript=a,n.getScriptSrcElements=l,n.determineCdnBasePrefix=h,n.determineCdnPathPrefix=d,n.determineCdnBaseHost=v,n.determineCdnPathHost=p,n.mkHlsJsLogLevelHelper=c.StringDevFlag.register("mk-hlsjs-log-level");const g=c.StringDevFlag.register("mk-hlsjs-version");function y(){const t=n.mkHlsJsLogLevelHelper.value,e="hls.js";switch(t){case"info":case"error":case"warn":return"hls.production.verbose.min.js";case"trace":case"debug":return console.warn(`HLS log level ${t} is not supported, loading production build.`),e;default:return e}}function m(t){try{return new URL(t).hostname.endsWith(".apple.com")}catch(n){}return!1}function b(t){var i;if((0,r.isNodeEnvironment)())return"";const o=null===(i=(0,e.getLocalStorage)())||void 0===i?void 0:i.getItem("mkCDNBaseURLOverride");if(o)return o;const s=a(t);return s?s.getAttribute("src").replace(new RegExp(`${t}$`),""):`${p()||v()}${n.DEFAULT_CDN_PATH}`}n.determineHlsJsBuild=y,n.getHlsJsCdnConfig=function(){const t={hls:"",rtc:""};if((0,r.isNodeEnvironment)())return t;const e=p()||v(),i=g.get()||n.HLSJS_VERSION,o=y();return t.hls=`https:${e}/hls.js/${i}/hls.js/${o}`,t.rtc=`https:${e}/hls.js/${i}/rtc.js/rtc.min.js`,function(t){const n=f.mkHlsJsAutomationConfigHelper.get();if(!(null==n?void 0:n.url))return;const{url:e}=n;m(e)&&"carry-"===h()&&(t.hls=e)}(t),t},n.isAppleHostname=m,n.cdnBaseURL=b;const E=new Map;n.loadScriptReset=function(){E.clear()},n.loadScript=function(t,n){const e=E.get(t);if(e)return e;const i=new Promise(((e,i)=>{if((0,r.isNodeEnvironment)()&&i("Dynamic script loading is unsupported in Node environments."),a(t))return e();const o=document.createElement("script");let s;n&&Object.keys(n).forEach((t=>{o.setAttribute(t,n[t])})),o.onload=()=>{e()},o.onerror=t=>{i(t)},s=u.test(t)?t:`${b(t)}${t}`,o.src=s,document.head.appendChild(o)}));return E.set(t,i),i}}));const h=(t,n)=>{var e,i,r,s;if(void 0===t||"string"==typeof t)return n;const u=null!==(r=null===(i=null===(e=t.images)||void 0===e?void 0:e.previewFrame)||void 0===i?void 0:i.joeColor)&&void 0!==r?r:void 0;return void 0===u?n:null!==(s=o(u).backgroundColor)&&void 0!==s?s:n};var d={setDelegate:!0};function v(t){return void 0!==t}function p(t){return v(t)&&null!==t}function g(t){return T(t)&&0===t.length}function y(t){return A(t)&&0===t.length}function m(t){return O(t)&&0===Object.keys(t).length}function b(t){return"function"==typeof t}function E(t){return"number"==typeof t}function S(t){return E(t)&&t%1==0}function T(t){return"string"==typeof t||t instanceof String}function A(t){return!!t&&t.constructor===Array}function O(t){return!!t&&t.constructor===Object}function w(t){return O(t)&&b(t.__lookupGetter__)&&b(t.__lookupSetter__)&&b(t.__defineGetter__)&&b(t.__defineSetter__)}function I(t){var n=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return _.apply(null,n)}function _(t,n,e,i){for(var r,o=e&&i||{},s=3;s<arguments.length;s++)for(var u in r=arguments[s])if(Object.prototype.hasOwnProperty.call(r,u)){var a=r[u];(t||null!=a)&&(n||"function"!=typeof a)&&(o[u]=a)}return o}function N(t,n,e,i){var r=!1;if(t&&n){i=i||{},e=e||n;var o=function(t,n,e,i){var r=function(){return e[i].apply(t,arguments)};return n&&(r.origFunction=n),r.attachedMethod=!0,r};for(var s in n)if(!(s in i)&&n[s]&&b(n[s])){var u=t[s],a=null;u&&b(u)&&(a=!0===u.attachedMethod?u:u.bind(t)),t[s]=o(e,a,n,s),r=!0}}return r}function R(t){var n=!1;for(var e in t)if(b(t[e])&&!0===t[e].attachedMethod)if(t[e].origFunction)for(;t[e].origFunction;)t[e]=t[e].origFunction,n=!0;else delete t[e];return n}function k(t,n){var e={};if(t)for(var i=0;i<t.length;i++)e[t[i]]=0;if(n)for(var r=0;r<n.length;r++)e[n[r]]=0;return Object.keys(e)}var x=Object.freeze({__proto__:null,_utResetNonOverridableFunctions:function(){d={setDelegate:!0}},shallowClone:function(t){var n,e,i={},r=w(t);for(var o in t)n=null,e=null,r&&(n=t.__lookupGetter__(o),e=t.__lookupSetter__(o)),n||e?(n&&i.__defineGetter__(o,n),e&&i.__defineSetter__(o,e)):i[o]=t[o];return i},isDefined:v,isDefinedNonNull:p,isDefinedNonNullNonEmpty:function(t){return p(t)&&!g(t)&&!y(t)&&!m(t)},isEmptyString:g,isEmptyArray:y,isEmptyObject:m,isFunction:b,isNumber:E,isInteger:S,isString:T,isElement:function(t){return!!t&&1==t.nodeType},isArray:A,isObject:O,values:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&!b(i)&&n.push(i)}return n},keys:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&!b(t[e])&&n.push(e);return n},hasAnyKeys:function(t){for(var n in t)if(t.hasOwnProperty(n))return!0},hasAnyNonNullKeys:function(t){for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0},hasGetterAndSetterMethods:w,methods:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&b(i)&&n.push(i)}return n},invert:function(t){var n={};for(var e in t)t.hasOwnProperty(e)&&!b(t[e])&&(n[t[e]]=e);return n},extend:I,copyKeysAndValues:_,addNonOverrideableFunctions:function(t){for(var n=0;n<t.length;n++)d[t[n]]=!0},attachMethods:N,detachMethods:R,attachDelegate:function(t,n){var e=!1;if(t&&n&&t!==n){var i={};Object.keys(n).forEach((function(n){t[n]||(i[n]=!0)})),I(i,d),e=N(t,n,null,i)}return e},setDelegates:function(t,n){var e={};for(var i in t)n[i]&&b(t[i].setDelegate)&&(e[i]=t[i].setDelegate(n[i]));return e},resetDelegates:function(t){var n=!1;for(var e in t){var i=t[e];i&&"object"==typeof i&&b(i.setDelegate)&&(n|=R(i))}return!!n},copyDelegatedFunctions:function(t,n){var e=null;if(t&&n&&n.setDelegate){var i,r={};for(i in t)b(t[i])&&t[i].origFunction&&(r[i]=t[i]);e=n.setDelegate(r)}return e},dedupedArray:k}),C=1500,M=100,P=2,D=function(t,n,e){this.delay=t||M,this.maxWait=E(n)?n:C,this.factor=e||P,this.timeWaited=0};function j(t,n,e,i){n.call(n,e,(function(){var r=t.nextDelay();r?setTimeout(j.bind(null,t,n,e,i),r):i.apply(i,arguments)}))}D.prototype.nextDelay=function(){var t=null,n=this.maxWait-this.timeWaited;return n>0&&(this.delay=Math.min(this.delay,n),this.timeWaited+=this.delay),(0===this.maxWait||n>0)&&(t=this.delay,this.delay=this.delay*this.factor),t};var U=Object.freeze({__proto__:null,exponentialBackoff:function(t,n,e,i,r,o){j(new D(i,r,o),t,n,e)}});function F(t){return!!this.value("disabled",t)}function L(t){var n=this.value("denylistedEvents",t);return k(this.value("blacklistedEvents",t),n)}function V(t){var n=this.value("denylistedFields",t);return k(this.value("blacklistedFields",t),n)}function H(t,n){if(t)for(var e=V.call(this,n),i=0;i<e.length;i++){var r=e[i];r&&r in t&&delete t[r]}return t}function K(t,n){return F.call(this,n)||!!t&&L.call(this,n).indexOf(t)>-1}function B(t){return this.value("deResFields",t)||[]}var q=Object.freeze({__proto__:null,disabled:F,blacklistedEvents:function(t){return L.call(this,t)},denylistedEvents:L,blacklistedFields:function(t){return V.call(this,t)},denylistedFields:V,removeBlacklistedFields:function(t,n){return H.call(this,t,n)},removeDenylistedFields:H,metricsDisabledOrBlacklistedEvent:function(t,n){return K.call(this,t,n)},metricsDisabledOrDenylistedEvent:K,deResFields:B,applyDeRes:function(t,n){var e;return t&&B.call(this,n).forEach((function(n){(e=n.fieldName)in t&&(t[e]=function(t,n,e){var i=void 0;if(v(t))if(v(n)||(n=1048576),v(e)||(e=2),E(t)&&E(n)&&n>0&&S(e)&&e>=0){var r=Math.pow(10,e);i=Math[t>0?"floor":"ceil"](t/n/r)*r}else i=NaN;return i}(t[e],n.magnitude,n.significantDigits))})),t}}),W="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxy",X=W+"z";function Y(t,n){var e="";if(t)for(var i,r=t.toLowerCase().split("_"),o=0;o<r.length;o++)i=r[o][0],(0!==o||n)&&(i=i.toUpperCase()),e+=i+r[o].slice(1);return e}function $(t,n,e){var i,r=global.crypto||global.msCrypto;return i=t?(16*t()|0).toString(16):r&&r.getRandomValues?(15&r.getRandomValues(new Uint8Array(1))[0]).toString(16):r&&r.randomBytes?r.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),n&&e&&(i<n||i>e)&&(i=$(t,n,e)),i}var G=Object.freeze({__proto__:null,base10Alphabet:"0123456789",base16Alphabet:"0123456789ABCDEF",base36Alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",base61Alphabet:W,base62Alphabet:X,startsWith:function(t,n,e){var i=!1;return t&&n&&(t=t.substr(0,n.length),e&&(t=t.toLowerCase(),n=n.toLowerCase()),i=0===t.indexOf(n)),i},endsWith:function(t,n,e){var i=!1;if(t&&n){e&&(t=t.toLowerCase(),n=n.toLowerCase());var r=t.length-n.length;i=r>=0&&t.lastIndexOf(n)===r}return i},trim:function(t,n,e){var i=null,r="\t\n\v\f\r             　\u2028\u2029​",o=new RegExp("^["+r+"]+"),s=new RegExp("["+r+"]+$");if(t)if(e||n&&n!=r||!t.trim){var u=null,a=null,c=null;n&&void 0!==n?(u="["+(n=n.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",a=new RegExp("^"+u+"+"),c=new RegExp(u+"+$")):(u=r,a=o,c=s),i=t.replace(a,"").replace(c,"")}else i=t.trim();return i},snakeCaseToCamelCase:Y,snakeCaseToUpperCamelCase:function(t){return Y(t,!0)},exceptionString:function(t,n){return"The function "+t+"."+n+"() must be overridden with a platform-specific delegate function.If you have no data for this function, have your delegate return null or undefined (no 'return')"},paramString:function(t){var n="",e="",i=!0;for(var r in t){var o=t[r];(o||0===o||!1===o)&&(n+=e+r+"="+encodeURIComponent(o),i&&(e="&",i=!1))}return n},versionStringFromUserAgent:function(t,n){var e=null;n=n||"\\S+";var i=new RegExp("\\b"+n+"/(\\S+)\\b","i").exec(t);return i&&i[1]&&(e=i[1]),e},requestId:function(t){var n=Date.now(),e=Math.floor(1e5*Math.random());return t+"z"+(n=n.toString(36).toUpperCase())+"z"+e.toString(36).toUpperCase()},uuid:function(t){for(var n,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i="",r=0,o=e.length;r<o;r++)i+="x"===(n=e.charAt(r))?$(t):"y"===n?$(t,"8","b"):n;return i},randomHexCharacter:$,convertNumberToBaseAlphabet:function(t,n){var e="",i=n.length;if(i<=36)e=t.toString(i).toUpperCase();else{for(var r,o,s=[];t>0;)o=n.charAt(r=t%i),s.push(o),t=(t-r)/i;e=s.reverse().join("")}return""===e&&(e="0"),e},cryptoRandomBase62String:function(t){var n;if(16777215==Math.floor(4294967295/256)){var e,i,r,o,s,u=global.crypto||global.msCrypto;if(u&&u.getRandomValues)e=u.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),s=!0;else if(u&&u.randomBytes){var a=u.randomBytes(16);e=new Uint32Array(a.buffer,a.byteOffset,a.byteLength/Uint32Array.BYTES_PER_ELEMENT),s=!0}else for(e=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),i=0;i<e.length;i++)e[i]=Math.floor(Math.random()*Math.floor(4294967295));if(e){for(n="",i=0;i<e.length;i++)for(o=e[i],r=0;r<6;r++)n+=X[o%62],o=Math.floor(o/62);t&&(n="1_"+(s?"1":"2")+"_"+n)}}return n}});function J(t,n,e){var i=n;if(t&&n)for(var r=t.split("."),o=0;i&&o<r.length;o++){var s=r[o];!(s in i)&&e&&(i[s]={}),i=s in i?i[s]:null}return i}function z(t){var n=[],e=[];e=e.concat(t),arguments&&arguments.length>1&&(e=e.concat(Array.prototype.slice.call(arguments,1)));for(var i=0;i<e.length;i++){var r=e[i];n=n.concat(r)}return n}var Q=Object.freeze({__proto__:null,valueForKeyPath:function(t){var n=null;if(t&&arguments.length>1)for(var e=z(Array.prototype.slice.call(arguments,1)),i=e.length-1;i>=0;i--){var r=e[i];if(p(n=J(t,r)))break}return n},createObjectAtKeyPath:function(t,n){return J(t,n,!0)},sourcesArray:z});function Z(t,n,e,i,r,o){var s=new XMLHttpRequest;e=e||void 0,o=o||{},i=b(i)?i:function(){},r=b(r)?r:function(){};var u=!1!==o.async;o.timeout&&u&&(s.timeout=o.timeout),s.onload=function(){s.status>=200&&s.status<300?i(s.response):r(new Error("XHR error: server responded with status "+s.status+" "+s.statusText),s.status)},s.onerror=function(){r(new Error("XHR error"))},s.open(n,t,u),s.withCredentials="boolean"!=typeof o.withCredentials||o.withCredentials,s.setRequestHeader("Content-type","application/json"),s.send(e)}var tt=Object.freeze({__proto__:null,makeAjaxGetRequest:function(t,n,e){Z(t,"GET",null,n,e)},makeAjaxRequest:Z}),nt="localStorage",et="sessionStorage",it=function(t){var n=null,e=!1;return function(){return t?n=t:(e||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),e=!0),n||(n={storage:{},getItem:function(t){return this.storage[t]},setItem:function(t,n){this.storage[t]=n},removeItem:function(t){delete this.storage[t]}})),n}};function rt(t){var n=null,e=t===nt;try{n="undefined"!=(e?typeof localStorage:typeof sessionStorage)?e?localStorage:sessionStorage:null}catch(i){n=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+i)}return n}var ot=it(rt(nt)),st=it(rt(et)),ut=Object.freeze({__proto__:null,_utDefaultStorageObject:function(t){return rt(t)},localStorageObject:ot,sessionStorageObject:st,saveObjectToStorage:function(t,n,e){var i=null;if(e)try{t.setItem(n,JSON.stringify(e)),i=e}catch(r){}else i=t.removeItem(n);return i},objectFromStorage:function(t,n){var e=null,i=t.getItem(n);if(i)try{e=JSON.parse(i)}catch(r){e=void 0}return e}});function at(t){this.key=t}at.prototype.toString=function(){return this.key};var ct={flagArguments:{INCLUDE_CALL_STACK:new at("INCLUDE_CALL_STACK"),MIRROR_TO_SERVER:new at("MIRROR_TO_SERVER"),SUPPRESS_CLIENT_OUTPUT:new at("SUPPRESS_CLIENT_OUTPUT")},setDelegate:function(t){return x.attachDelegate(this,t)},execute:function(t,n,e){var i=t.levelStringToIntMap[n];if(t.level()!==t.NONE&&t.level()<=i){var r=Array.prototype.slice.call(e),o=ct.nonFlagLogArguments(r),s=ct.logOptions(t,i,r),u=s.includeCallStack?(new Error).stack:null,a=u?o.concat("\n"+u):o;if(t[n]._lastLog=a,s.mirrorToServer&&ct.sendToServer(t,n,o,u),s.throwInsteadOfPrint)throw new Error(o.toString());s.suppressClientOutput||(console[n]?console[n].apply(console,a):console.log.apply(console,a))}},isFlagObject:function(t){return t&&t===ct.flagArguments[t.toString()]},nonFlagLogArguments:function(t){return t.filter((function(t){return!ct.isFlagObject(t)}))},logOptions:function(t,n,e){var i,r={};return e.forEach((function(t){ct.isFlagObject(t)&&(i=G.snakeCaseToCamelCase(t.toString()),r[i]=!0)})),x.isFunction(t.mirrorToServerLevel)&&t.mirrorToServerLevel()!==t.NONE&&t.mirrorToServerLevel()<=n&&(r.mirrorToServer=!0),t.throwLevel()!==t.NONE&&t.throwLevel()<=n&&(r.throwInsteadOfPrint=!0),r},sendToServer:function(){}},ft={NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},lt={MIN_LEVEL:ft.NONE,MAX_LEVEL:ft.ERROR,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}};x.extend(lt,ft);var ht={loggerName:"defaultLogger",level:lt.INFO,throwLevel:lt.NONE},dt=!1,vt={};function pt(t){this._loggerName=t,dt||(dt=!0,x.extend(pt.prototype,lt),x.extend(pt.prototype,ct.flagArguments))}function gt(t){var n=vt[t=t||ht.loggerName];return n||(n=new pt(t),vt[t]=n),n}pt.level=function(){return ht.level},pt.throwLevel=function(){return ht.throwLevel},pt.prototype.setDelegate=function(t){return x.attachDelegate(this,t)},pt.prototype.loggerName=function(){return this._loggerName},pt.prototype.levelParameterAsInt=function(t){var n,e=null;return x.isString(t)?n=this.levelStringToIntMap[t.toLowerCase()]:x.isNumber(t)&&(n=t),n>=this.MIN_LEVEL&&n<=this.MAX_LEVEL&&(e=n),e},pt.prototype.setLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._level=n)},pt.prototype.setThrowLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._throwLevel=n)},pt.prototype.level=function(){var t=this._level;return x.isNumber(t)?t:pt.level()},pt.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},pt.prototype.throwLevel=function(){var t=this._throwLevel;return x.isNumber(t)?t:pt.throwLevel()},pt.prototype.debug=function(){ct.execute(this,"debug",arguments)},pt.prototype.info=function(){ct.execute(this,"info",arguments)},pt.prototype.warn=function(){ct.execute(this,"warn",arguments)},pt.prototype.error=function(){ct.execute(this,"error",arguments)},pt.prototype.lastLog=function(t){return this[t]?this[t]._lastLog:null};var yt=x.attachDelegate,mt={setDelegate:function(t){return yt(this,t)},localStorageObject:ut.localStorageObject,sessionStorageObject:ut.sessionStorageObject},bt=x.attachDelegate,Et={setDelegate:function(t){return bt(this,t)},makeAjaxRequest:tt.makeAjaxRequest},St=x.attachDelegate,Tt=x.hasAnyKeys,At=x.isArray,Ot=ut.saveObjectToStorage,wt=ut.objectFromStorage,It=U.exponentialBackoff,_t=Q.valueForKeyPath,Nt={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},Rt={},kt=function(t,n,e){if(e){t.push(e);var i=e[n];i&&Tt(i)&&t.push(i)}},xt=function(t){this._topic=t,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+Nt.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+Nt.compoundSeparator+this._topic};xt.createConfig=function(t,n,e,i){var r=xt.getConfig(t);return t&&"noTopicConfig"!==t&&!r._initCalled&&r.init(n,e,i),r},xt.getConfig=function(t){var n=Rt[t=t||"noTopicConfig"];return n||(n=new xt(t),Rt[t]=n),n},xt.cleanupConfig=function(t){if(t&&Rt[t]){var n=Rt[t];n.setCachedSource(),n.setDebugSource(),delete Rt[t]}},xt.defaultConfig=function(){return xt.getConfig()},xt.value=function(t,n){var e=n&&Rt[n]||xt.defaultConfig();return e.value.call(e,t)},xt.environment=mt,xt.logger=gt("mt-client-config"),xt.network=Et,xt.prototype._defaults=function(){return Nt},xt.prototype._setInitialized=function(t){this._initialized=t},xt.prototype._setInitCalled=function(t){this._initCalled=t},xt.prototype._setShowedDebugWarning=function(t){this._showedDebugWarning=t},xt.prototype._setShowedNoProvidedSourceWarning=function(t){this._showedNoProvidedSourceWarning=t},xt.prototype.setDelegate=function(t){return St(this,t)},xt.prototype.topic=function(){return this._topic},xt.prototype.configHostname=function(){},xt.prototype.configUrl=function(){var t,n=this.configHostname();return t=n?"https://"+n+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?t+="/"+this.topic():xt.logger.error("config.configUrl(): Topic must be provided"),t},xt.prototype.sources=function(){},xt.prototype.value=function(t){var n,e=this.cachedSource(),i=this.serviceSource(),r=this.sources(),o=this.debugSource(),s=e||i||r||o;return r||i||t in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,xt.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),o&&(this._showedDebugWarning||(this._showedDebugWarning=!0,xt.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),At(r)||(r=[r]),n=0===t.indexOf("blacklisted")?s?[e,i,r,o]:[Nt]:[Nt,e,i,r,o],n=this.configSourcesWithOverrides(n,this.topic()),_t.apply(null,[t].concat(n))},xt.prototype.configSourcesWithOverrides=function(t,n){var e=t;if(t&&t.length&&n){e=[];for(var i=0;i<t.length;i++){var r=t[i];if(r)if(At(r)&&r.length){for(var o=[],s=0;s<r.length;s++)kt(o,n,r[s]);e.push(o)}else kt(e,n,r)}}return e},xt.prototype.setDebugSource=function(t){return this._debugSource=t||null,Ot(mt.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},xt.prototype.debugSource=function(){return this._debugSource||(this._debugSource=wt(mt.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},xt.prototype.setCachedSource=function(t){return this._cachedSource=t||null,Ot(mt.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},xt.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=wt(mt.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},xt.prototype.setServiceSource=function(t){return this._serviceSource=t,this._serviceSource},xt.prototype.serviceSource=function(){return this._serviceSource},xt.prototype.fetchConfig=function(t,n,e){e=e||function(){},It(Et.makeAjaxRequest.bind(Et,t,"GET",null),(function(t){var i;try{t=JSON.parse(t),i=!0}catch(r){e.call(e,r)}i&&n&&n.call(n,t)}),e)},xt.prototype.init=function(t,n,e){if(!this._initCalled){this._initCalled=!0,n=n||function(){};var i=function(){this._initialized=!0,n.call(n)}.bind(this);if(t)this.setDelegate({sources:t}),i();else{this.setCachedSource(this.cachedSource());var r=this.configUrl(),o=function(t){this.setCachedSource(t),this.setServiceSource(t),i()}.bind(this);this.fetchConfig(r,o,e)}}},xt.prototype.initialize=function(t,n,e){return this.init.apply(this,Array.prototype.slice.call(arguments))},xt.prototype.initialized=function(){return this._initialized};var Ct=q.metricsDisabledOrDenylistedEvent,Mt=q.removeDenylistedFields,Pt={},Dt=["dsId","consumerId"];function jt(t,n,e){var i=null;return e&&!Ct.call(xt,e.eventType,n)&&(Mt.call(xt,e,n),Ut(n,e),t.apply(null,Array.prototype.slice.call(arguments,1)),i=e),i}function Ut(t,n){Pt[t]=Pt[t]||{},Pt[t].anonymous&&Dt.forEach((function(t){delete n[t]}))}var Ft=x.attachDelegate,Lt={setDelegate:function(t){return Ft(this,t)},makeAjaxRequest:tt.makeAjaxRequest};function Vt(t,n){var e=function(t){var n=null;if(t&&t.length){var e={deliveryVersion:"1.0"};e.postTime=Date.now(),e.events=t;try{n=JSON.stringify(e)}catch(i){gt("mt-event-queue").error("Error stringifying events as JSON: "+i)}}return n}([n]);if(e){var i=function(t){return xt.value("metricsUrl",t)+"/2/"+t}(t),r={timeout:function(t){var n=xt.value("requestTimeout",t)||1e4;return Math.min(n,xt.value("postFrequency",t))}(t)};Pt[t]&&Pt[t].anonymous&&(r.withCredentials=!1),Lt.makeAjaxRequest(i,"POST",e,null,null,r)}}var Ht={_document:function(){if("undefined"!=typeof document)return document;throw"metricskit-delegates-html.environment HTML delegate 'document' object not found"},_window:function(){if("undefined"!=typeof window)return window;throw"metricskit-delegates-html.environment HTML delegate 'window' object not found"},cookie:function(){return Ht._window().document.cookie},pageUrl:function(){return Ht._window().location.href},parentPageUrl:function(){var t,n=Ht._window(),e=n.parent;if(e!==n)try{t=e.location.href}catch(i){t=Ht._document().referrer}return t},pixelRatio:function(){return Ht._window().devicePixelRatio},screenHeight:function(){return Ht._window().screen.height},screenWidth:function(){return Ht._window().screen.width},userAgent:function(){return Ht._window().navigator.userAgent},windowInnerHeight:function(){return Ht._window().innerHeight},windowInnerWidth:function(){return Ht._window().innerWidth},windowOuterHeight:function(){return Ht._window().outerHeight},windowOuterWidth:function(){return Ht._window().outerWidth},timeOriginOffset:function(){var t=null,n=Ht._window().performance;return n&&n.timing&&(t=n.timing.navigationStart),t},app:function(){},appVersion:function(){},capacityData:function(){},capacityDataAvailable:function(){},capacityDisk:function(){},capacitySystem:function(){},capacitySystemAvailable:function(){},connectionType:function(){},dsId:function(){},hardwareBrand:function(){},hardwareFamily:function(){},hardwareModel:function(){},hostApp:function(){},hostAppVersion:function(){},os:function(){},osBuildNumber:function(){},osLanguages:function(){},osVersion:function(){},resourceRevNum:function(){},storeFrontCountryCode:function(){},storeFrontHeader:function(){},userType:function(){}},Kt={recordEvent:function(){return jt.apply(null,[Vt].concat(Array.prototype.slice.call(arguments)))},sendMethod:function(){return"javascript"},setProperties:function(t,n){Pt[t]=Pt[t]||{},Pt[t]=n},cleanup:function(){Pt={}}},Bt=1500,qt=100,Wt=2,Xt=function(t,n,e){this.delay=t||qt,this.maxWait="number"==typeof n?n:Bt,this.factor=e||Wt,this.timeWaited=0};Xt.prototype.nextDelay=function(){var t=null,n=this.maxWait-this.timeWaited;return n>0&&(this.delay=Math.min(this.delay,n),this.timeWaited+=this.delay),(0===this.maxWait||n>0)&&(t=this.delay,this.delay=this.delay*this.factor),t};var Yt={_backoff:function(t,n,e,i){n.call(n,e,(function(){var r=t.nextDelay();r?setTimeout(Yt._backoff.bind(Yt,t,n,e,i),r):i.apply(i,arguments)}))},exponentialBackoff:function(t,n,e,i,r,o){var s=new Xt(i,r,o);Yt._backoff(s,t,n,e)}},$t=Yt,Gt={},Jt={},zt=function(t){var n={};return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n.name=t.mtName(),n.version=t.mtVersion()),n},Qt=function(t){var n;return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n=t.mtName()+t.mtVersion()),n},Zt={storeDelegateInfo:function(t,n){var e=Qt(t),i=Qt(n);e&&i&&(Gt[i]||(Gt[i]=zt(n)),Gt[e]||(Gt[e]=zt(t),Jt[e]={}),Gt[e].delegates?Jt[e][i]||Gt[e].delegates.push(Gt[i]):Gt[e].delegates=[Gt[i]],Jt[e][i]=!0)},getStoredDelegateObject:function(t){return Gt[Qt(t)]}},tn={setDelegate:!0},nn={_utResetNonOverridableFunctions:function(){tn={setDelegate:!0}},functionName:function t(){return t.caller.name},shallowClone:function(t){var n,e,i={},r=nn.hasGetterAndSetterMethods(t);for(var o in t)n=null,e=null,r&&(n=t.__lookupGetter__(o),e=t.__lookupSetter__(o)),n||e?(n&&i.__defineGetter__(o,n),e&&i.__defineSetter__(o,e)):i[o]=t[o];return i},isDefined:function(t){return void 0!==t},isDefinedNonNull:function(t){return this.isDefined(t)&&null!==t},isDefinedNonNullNonEmpty:function(t){return nn.isDefinedNonNull(t)&&!nn.isEmptyString(t)&&!nn.isEmptyArray(t)&&!nn.isEmptyObject(t)},isEmptyString:function(t){return nn.isString(t)&&0===t.length},isEmptyArray:function(t){return nn.isArray(t)&&0===t.length},isEmptyObject:function(t){return nn.isObject(t)&&0===Object.keys(t).length},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"number"==typeof t},isInteger:function(t){return nn.isNumber(t)&&t%1==0},isString:function(t){return"string"==typeof t||t instanceof String},isElement:function(t){return t&&1==t.nodeType},isArray:function(t){return t&&t.constructor===Array},isObject:function(t){return t&&t.constructor===Object},values:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&!nn.isFunction(i)&&n.push(i)}return n},keys:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&!nn.isFunction(t[e])&&n.push(e);return n},hasAnyKeys:function(t){for(var n in t)if(t.hasOwnProperty(n))return!0},hasAnyNonNullKeys:function(t){for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0},hasGetterAndSetterMethods:function(t){return nn.isObject(t)&&nn.isFunction(t.__lookupGetter__)&&nn.isFunction(t.__lookupSetter__)&&nn.isFunction(t.__defineGetter__)&&nn.isFunction(t.__defineSetter__)},methods:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&nn.isFunction(i)&&n.push(i)}return n},invert:function(t){var n={};for(var e in t)t.hasOwnProperty(e)&&!nn.isFunction(t[e])&&(n[t[e]]=e);return n},extend:function(){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return this.copyKeysAndValues.apply(this,t)},copyKeysAndValues:function(t,n,e,i){for(var r,o,s,u,a=e&&i||{},c=3;c<arguments.length;c++)for(var f in o=nn.hasGetterAndSetterMethods(r=arguments[c]),r)if(s=null,u=null,o&&(s=r.__lookupGetter__(f),u=r.__lookupSetter__(f)),s||u)s&&a.__defineGetter__(f,s),u&&a.__defineSetter__(f,u);else if(Object.prototype.hasOwnProperty.call(r,f)){var l=r[f];(t||null!=l)&&(n||"function"!=typeof l)&&(a[f]=l)}return a},addNonOverrideableFunctions:function(t){for(var n=0;n<t.length;n++)tn[t[n]]=!0},attachDelegate:function(t,n){var e=!1;if(t&&n&&t!==n){Zt.storeDelegateInfo(t,n);var i={};Object.keys(n).forEach((function(n){t[n]||(i[n]=!0)})),nn.extend(i,tn),e=nn.attachMethods(t,n,null,i)}return e},attachMethods:function(t,n,e,i){var r=!1;if(t&&n){i=i||{},e=e||n;var o=function(t,n,e,i){var r=function(){return e[i].apply(t,arguments)};return n&&(r.origFunction=n),r};for(var s in n)if(!(s in i)&&n[s]&&"function"==typeof n[s]){var u=t[s],a=u&&"function"==typeof u?u.bind(t):null;t[s]=o(e,a,n,s),r=!0}}return r},setDelegates:function(t,n){var e={};for(var i in t)n[i]&&nn.isFunction(t[i].setDelegate)&&(e[i]=t[i].setDelegate(n[i]));return e},copyDelegatedFunctions:function(t,n){var e=null;if(t&&n&&n.setDelegate){var i,r={};for(i in t)nn.isFunction(t[i])&&t[i].origFunction&&(r[i]=t[i]);e=n.setDelegate(r)}return e}},en=nn,rn={deResNumber:function(t,n,e){var i=void 0;if(en.isDefined(t))if(en.isDefined(n)||(n=1048576),en.isDefined(e)||(e=2),en.isNumber(t)&&en.isNumber(n)&&n>0&&en.isInteger(e)&&e>=0){var r=Math.pow(10,e);i=Math[t>0?"floor":"ceil"](t/n/r)*r}else i=NaN;return i}},on={disabled:function(t){return!!this.value("disabled",t)},blacklistedEvents:function(t){return this.value("blacklistedEvents",t)||[]},blacklistedFields:function(t){return this.value("blacklistedFields",t)||[]},removeBlacklistedFields:function(t,n){if(t)for(var e=on.blacklistedFields.call(this,n),i=0;i<e.length;i++){var r=e[i];r&&r in t&&delete t[r]}return t},metricsDisabledOrBlacklistedEvent:function(t,n){return on.disabled.call(this,n)||!!t&&on.blacklistedEvents.call(this,n).indexOf(t)>-1},deResFields:function(t){return this.value("deResFields",t)||[]},applyDeRes:function(t,n){var e;return t&&on.deResFields.call(this,n).forEach((function(n){(e=n.fieldName)in t&&(t[e]=rn.deResNumber(t[e],n.magnitude,n.significantDigits))})),t}},sn=on,un={startsWith:function(t,n,e){var i=!1;return t&&n&&(t=t.substr(0,n.length),e&&(t=t.toLowerCase(),n=n.toLowerCase()),i=0===t.indexOf(n)),i},endsWith:function(t,n,e){var i=!1;if(t&&n){e&&(t=t.toLowerCase(),n=n.toLowerCase());var r=t.length-n.length;i=r>=0&&t.lastIndexOf(n)===r}return i},trim:function(t,n,e){var i=null,r="\t\n\v\f\r             　\u2028\u2029​",o=new RegExp("^["+r+"]+"),s=new RegExp("["+r+"]+$");if(t)if(e||n&&n!=r||!t.trim){var u=null,a=null,c=null;n&&void 0!==n?(u="["+(n=n.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",a=new RegExp("^"+u+"+"),c=new RegExp(u+"+$")):(u=r,a=o,c=s),i=t.replace(a,"").replace(c,"")}else i=t.trim();return i},snakeCaseToCamelCase:function(t,n){var e="";if(t)for(var i,r=t.toLowerCase().split("_"),o=0;o<r.length;o++)i=r[o][0],(0!==o||n)&&(i=i.toUpperCase()),e+=i+r[o].slice(1);return e},snakeCaseToUpperCamelCase:function(t){return un.snakeCaseToCamelCase(t,!0)},paramString:function(t){var n="",e="",i=!0;for(var r in t){var o=t[r];(o||0===o||!1===o)&&(n+=e+r+"="+encodeURIComponent(o),i&&(e="&",i=!1))}return n},versionStringFromUserAgent:function(t,n){var e=null;n=n||"\\S+";var i=new RegExp("\\b"+n+"/(\\S+)\\b","i").exec(t);return i&&i[1]&&(e=i[1]),e},requestId:function(t){var n=Date.now(),e=Math.floor(1e5*Math.random());return t+"z"+(n=n.toString(36).toUpperCase())+"z"+e.toString(36).toUpperCase()},uuid:function(t){for(var n,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i="",r=0,o=e.length;r<o;r++)i+="x"===(n=e.charAt(r))?un.randomHexCharacter(t):"y"===n?un.randomHexCharacter(t,"8","b"):n;return i},randomHexCharacter:function(t,e,i){var r,o=n.crypto||n.msCrypto;return r=t?(16*t()|0).toString(16):o&&o.getRandomValues?(15&o.getRandomValues(new Uint8Array(1))[0]).toString(16):o&&o.randomBytes?o.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),e&&i&&(r<e||r>i)&&(r=un.randomHexCharacter(t,e,i)),r},weakUUID:function(){return un.uuid()},convertNumberToBaseAlphabet:function(t,n){var e="",i=n.length;if(i<=36)e=t.toString(i).toUpperCase();else{for(var r,o,s=[];t>0;)o=n.charAt(r=t%i),s.push(o),t=(t-r)/i;e=s.reverse().join("")}return""===e&&(e="0"),e},cryptoRandomBase62String:function(t){var e;if(16777215==Math.floor(4294967295/256)){var i,r,o,s,u,a=n.crypto||n.msCrypto;if(a&&a.getRandomValues)i=a.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),u=!0;else if(a&&a.randomBytes){var c=a.randomBytes(16);i=new Uint32Array(c.buffer,c.byteOffset,c.byteLength/Uint32Array.BYTES_PER_ELEMENT),u=!0}else for(i=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),r=0;r<i.length;r++)i[r]=Math.floor(Math.random()*Math.floor(4294967295));if(i){for(e="",r=0;r<i.length;r++)for(s=i[r],o=0;o<6;o++)e+=un.base62Alphabet[s%62],s=Math.floor(s/62);t&&(e="1_"+(u?"1":"2")+"_"+e)}}return e},base10Alphabet:"0123456789"};un.base16Alphabet=un.base10Alphabet+"ABCDEF",un.base36Alphabet=un.base10Alphabet+"ABCDEFGHIJKLMNOPQRSTUVWXYZ",un.base61Alphabet=un.base36Alphabet+"abcdefghijklmnopqrstuvwxy",un.base62Alphabet=un.base61Alphabet+"z";var an=un,cn={setDelegate:function(t){return en.attachDelegate(this,t)},cookie:function(){var t;return"undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes?t=iTunes:"undefined"!=typeof itms&&void 0!==itms.cookie?t=itms:"undefined"!=typeof document&&(t=document),t?t.cookie:void 0},cookieOwnerObject:function(){if("undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes)return iTunes;if("undefined"!=typeof itms&&void 0!==itms.cookie)return itms;if("undefined"!=typeof document)return document;throw"cookies.cookieOwnerObject: No owning object"},get:function(t){var n=this.getUnescaped(t);return n&&(n=unescape(n)),n},getUnescaped:function(t){var n=null,e=this._getRaw();if(e&&t)for(var i=e.split(";"),r=i.length-1;!n&&r>=0;r--){var o=i[r],s=o.indexOf("=");s>0&&(s+1==o.length?n="":an.trim(o.substring(0,s))==t&&(n=an.trim(o.substring(s+1))))}return n},remove:function(t,n){return this.setUnescaped(t,".",this.EXPIRE_NOW,null,n)},_getRaw:function(){var t=this.cookie();return en.isString(t)||(t=this.cookieOwnerObject().cookie),t||""},EXPIRE_NOW:-1,EXPIRE_SESSION:null,EXPIRE_ONE_SECOND:1};cn.EXPIRE_ONE_MINUTE=60*cn.EXPIRE_ONE_SECOND,cn.EXPIRE_ONE_HOUR=60*cn.EXPIRE_ONE_MINUTE,cn.EXPIRE_ONE_DAY=24*cn.EXPIRE_ONE_HOUR,cn.EXPIRE_ONE_WEEK=7*cn.EXPIRE_ONE_DAY,cn.EXPIRE_ONE_MONTH=31*cn.EXPIRE_ONE_DAY,cn.EXPIRE_ONE_YEAR=365*cn.EXPIRE_ONE_DAY,cn.EXPIRE_ONE_SIDEREAL_YEAR=365.25*cn.EXPIRE_ONE_DAY,cn.EXPIRE_SIX_MONTHS=180*cn.EXPIRE_ONE_DAY;var fn=cn,ln={_valueForKeyPath:function(t,n,e){var i=n;if(t&&n)for(var r=t.split("."),o=0;i&&o<r.length;o++){var s=r[o];!(s in i)&&e&&(i[s]={}),i=s in i?i[s]:null}return i},valueForKeyPath:function(t){var n=null;if(t&&arguments.length>1)for(var e=this.sourcesArray(Array.prototype.slice.call(arguments,1)),i=e.length-1;i>=0;i--){var r=e[i];if(n=this._valueForKeyPath(t,r),en.isDefinedNonNull(n))break}return n},createObjectAtKeyPath:function(t,n){return this._valueForKeyPath(t,n,!0)},sourcesArray:function(t){var n=[],e=[];e=e.concat(t),arguments&&arguments.length>1&&(e=e.concat(Array.prototype.slice.call(arguments,1)));for(var i=0;i<e.length;i++){var r=e[i];n=n.concat(r)}return n}},hn={mergeAndCleanEventFields:function(){for(var t=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),n=[],e=0;e<t.length;e++){var i=t[e];if(i&&i.constructor===Array)for(var r=0;r<i.length;r++)n.push(i[r]);else n.push(i)}return en.copyKeysAndValues.apply(this,n)},processMetricsData:function(t,n,e,i){var r=this.mergeAndCleanEventFields(i),o=r;if(t&&n){var s={};if(e||(n=n.filter((function(t){return t in r}))),n.length)for(var u=0;u<n.length;u++){var a=n[u],c=t[a];"function"==typeof c&&(s[a]=c.call(t,r))}o=this.mergeAndCleanEventFields(o,s)}return o},applyFieldsMap:function(t,n,e,i){var r,o,s;if(t&&n&&e){var u,a;if(o={},r=ln.valueForKeyPath(n,e,e.custom))if(en.isArray(r))for(u=0;u<r.length;++u)en.isDefinedNonNull(a=t[r[u]])&&(o[r[u]]=a);else if("object"==typeof r){for(var c in r)for(u=0;u<r[c].length;++u)if(a=ln.valueForKeyPath(r[c][u],t),en.isDefinedNonNull(a)){o[c]=a;break}}else s="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else s="metrics: unable to get "+n+" section from fieldsMap"}else{var f=[];t||f.push("data"),n||f.push("sectionName"),e||f.push("fieldsMap"),s="metrics: missing argument(s): "+f.join(",")+" not provided to applyFieldsMap"}return s&&en.isFunction(i)&&i(s),o}},dn={makeAjaxGetRequest:function(t,n,e){this.makeAjaxRequest(t,"GET",null,n,e)},makeAjaxRequest:function(t,n,e,i,r,o){var s=new XMLHttpRequest;e=e||void 0,o=o||{},i=en.isFunction(i)?i:function(){},r=en.isFunction(r)?r:function(){};var u=!1!==o.async;o.timeout&&u&&(s.timeout=o.timeout),s.onload=function(){s.status>=200&&s.status<300?i(s.response):r(new Error("XHR error: server responded with status "+s.status+" "+s.statusText),s.status)},s.onerror=function(){r(new Error("XHR error"))},s.open(n,t,u),s.withCredentials=!0,s.setRequestHeader("Content-type","application/json"),s.send(e)}},vn={},pn=function(t){vn[t]&&(clearTimeout(vn[t]),vn[t]=null)},gn={_utClearSessions:function(){for(var t in vn)pn(t)},lottery:function(t){return Math.random()<t},sessionSampled:function(t,n,e){var i;if(vn[t])i=!0;else{var r=gn.lottery(n);r&&e>0&&(vn[t]=setTimeout(pn.bind(null,t),e)),i=r}return i},isSampledIn:function(t,n,e,i,r){return n||gn.sessionSampled(t,e,i)||gn.lottery(r)}},yn=gn,mn="localStorage",bn="sessionStorage",En=function(t){var n=null,e=!1;return function(){return t?n=t:(e||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),e=!0),n||(n={storage:{},getItem:function(t){return this.storage[t]},setItem:function(t,n){this.storage[t]=n},removeItem:function(t){delete this.storage[t]}})),n}};function Sn(t){var n=null,e=t===mn;try{n="undefined"!=(e?typeof localStorage:typeof sessionStorage)?e?localStorage:sessionStorage:null}catch(i){n=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+i)}return n}var Tn={_utDefaultStorageObject:function(t){return Sn(t)},localStorageObject:En(Sn(mn)),sessionStorageObject:En(Sn(bn)),saveObjectToStorage:function(t,n,e){var i=null;if(e)try{t.setItem(n,JSON.stringify(e)),i=e}catch(r){}else i=t.removeItem(n);return i},objectFromStorage:function(t,n){var e=null,i=t.getItem(n);if(i)try{e=JSON.parse(i)}catch(r){e=void 0}return e}},An={};An.backoff=$t,An.config=sn,An.cookies=fn,An.delegatesInfo=Zt,An.eventFields=hn,An.keyValue=ln,An.network=dn,An.number=rn,An.reflect=en,An.sampling=yn,An.storage=Tn,An.string=an,An.optionValueFromStoreFrontHeader=function(t,n){for(var e=null,i="string"==typeof t?t.split(" "):[],r=An.string.endsWith(n,":")?n:n+":",o=0;!e&&o<i.length;++o)0===i[o].search(r)&&(e=i[o].slice(r.length));return e};var On=An,wn={setDelegate:function(t){return On.reflect.attachDelegate(this,t)},localStorageObject:On.storage.localStorageObject,sessionStorageObject:On.storage.sessionStorageObject},In={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(t){return On.reflect.attachDelegate(this,t)},execute:function(t,n,e){var i=t.levelStringToIntMap[n];if(t.level()!==t.NONE&&t.level()<=i){var r=Array.prototype.slice.call(e),o=In.nonFlagLogArguments(r),s=In.logOptions(t,i,r),u=s.includeCallStack?(new Error).stack:null,a=u?o.concat("\n"+u):o;if(t[n]._lastLog=a,s.mirrorToServer&&In.sendToServer(t,n,o,u),s.throwInsteadOfPrint)throw new Error(o.toString());s.suppressClientOutput||(console[n]?console[n].apply(console,a):console.log.apply(console,a))}},isFlagObject:function(t){return t&&t===In.flagArguments[t.constructor.name]},nonFlagLogArguments:function(t){return t.filter((function(t){return!In.isFlagObject(t)}))},logOptions:function(t,n,e){var i,r={};return e.forEach((function(t){In.isFlagObject(t)&&(i=On.string.snakeCaseToCamelCase(t.constructor.name),r[i]=!0)})),On.reflect.isFunction(t.mirrorToServerLevel)&&t.mirrorToServerLevel()!==t.NONE&&t.mirrorToServerLevel()<=n&&(r.mirrorToServer=!0),t.throwLevel()!==t.NONE&&t.throwLevel()<=n&&(r.throwInsteadOfPrint=!0),r},sendToServer:function(){}},_n=In,Nn={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},Rn={loggerName:"defaultLogger",level:Nn.INFO,throwLevel:Nn.NONE},kn={},xn=function(t){this._loggerName=t};xn.loggerNamed=function(t){var n=kn[t=t||Rn.loggerName];return n||(n=new xn(t),kn[t]=n),n},xn.level=function(){return Rn.level},xn.throwLevel=function(){return Rn.throwLevel},On.reflect.extend(xn.prototype,Nn),On.reflect.extend(xn.prototype,_n.flagArguments),xn.prototype.setDelegate=function(t){return On.reflect.attachDelegate(this,t)},xn.prototype.loggerName=function(){return this._loggerName},xn.prototype.levelParameterAsInt=function(t){var n,e=null;return On.reflect.isString(t)?n=this.levelStringToIntMap[t.toLowerCase()]:On.reflect.isNumber(t)&&(n=t),n>=this.MIN_LEVEL&&n<=this.MAX_LEVEL&&(e=n),e},xn.prototype.setLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._level=n)},xn.prototype.setThrowLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._throwLevel=n)},xn.prototype.level=function(){var t=this._level;return On.reflect.isNumber(t)?t:xn.level()},xn.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},xn.prototype.throwLevel=function(){var t=this._throwLevel;return On.reflect.isNumber(t)?t:xn.throwLevel()},xn.prototype.debug=function(){_n.execute(this,"debug",arguments)},xn.prototype.info=function(){_n.execute(this,"info",arguments)},xn.prototype.warn=function(){_n.execute(this,"warn",arguments)},xn.prototype.error=function(){_n.execute(this,"error",arguments)},xn.prototype.lastLog=function(t){return this[t]?this[t]._lastLog:null};var Cn=xn;Cn.utils=_n;var Mn=Cn,Pn=Mn.loggerNamed("mt-client-config"),Dn={setDelegate:function(t){return On.reflect.attachDelegate(this,t)},makeAjaxRequest:On.network.makeAjaxRequest},jn={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},Un={},Fn=function(t,n,e){if(e){t.push(e);var i=e[n];i&&On.reflect.hasAnyKeys(i)&&t.push(i)}},Ln=function(t){this._topic=t,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+jn.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+jn.compoundSeparator+this._topic};Ln.createConfig=function(t,n,e,i){var r=Ln.getConfig(t);return t&&"noTopicConfig"!==t&&!r._initCalled&&r.init(n,e,i),r},Ln.getConfig=function(t){var n=Un[t=t||"noTopicConfig"];return n||(n=new Ln(t),Un[t]=n),n},Ln.cleanupConfig=function(t){if(t&&Un[t]){var n=Un[t];n.setCachedSource(),n.setDebugSource(),delete Un[t]}},Ln.defaultConfig=function(){return Ln.getConfig()},Ln.value=function(t,n){var e=n&&Un[n]||Ln.defaultConfig();return e.value.call(e,t)},Ln.environment=wn,Ln.logger=Pn,Ln.network=Dn,Ln.prototype._defaults=function(){return jn},Ln.prototype._setInitialized=function(t){this._initialized=t},Ln.prototype._setInitCalled=function(t){this._initCalled=t},Ln.prototype._setShowedDebugWarning=function(t){this._showedDebugWarning=t},Ln.prototype._setShowedNoProvidedSourceWarning=function(t){this._showedNoProvidedSourceWarning=t},Ln.prototype.setDelegate=function(t){return On.reflect.attachDelegate(this,t)},Ln.prototype.topic=function(){return this._topic},Ln.prototype.configHostname=function(){},Ln.prototype.configUrl=function(){var t,n=this.configHostname();return t=n?"https://"+n+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?t+="/"+this.topic():Ln.logger.error("config.configUrl(): Topic must be provided"),t},Ln.prototype.sources=function(){},Ln.prototype.value=function(t){var n,e=this.cachedSource(),i=this.serviceSource(),r=this.sources(),o=this.debugSource(),s=e||i||r||o;return r||i||t in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,Ln.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),o&&(this._showedDebugWarning||(this._showedDebugWarning=!0,Ln.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),On.reflect.isArray(r)||(r=[r]),n=0===t.indexOf("blacklisted")?s?[e,i,r,o]:[jn]:[jn,e,i,r,o],n=this.configSourcesWithOverrides(n,this.topic()),On.keyValue.valueForKeyPath.apply(On.keyValue,[t].concat(n))},Ln.prototype.configSourcesWithOverrides=function(t,n){var e=t;if(t&&t.length&&n){e=[];for(var i=0;i<t.length;i++){var r=t[i];if(r)if(On.reflect.isArray(r)&&r.length){for(var o=[],s=0;s<r.length;s++)Fn(o,n,r[s]);e.push(o)}else Fn(e,n,r)}}return e},Ln.prototype.setDebugSource=function(t){return this._debugSource=t||null,On.storage.saveObjectToStorage(Ln.environment.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},Ln.prototype.debugSource=function(){return this._debugSource||(this._debugSource=On.storage.objectFromStorage(Ln.environment.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},Ln.prototype.setCachedSource=function(t){return this._cachedSource=t||null,On.storage.saveObjectToStorage(Ln.environment.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},Ln.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=On.storage.objectFromStorage(Ln.environment.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},Ln.prototype.setServiceSource=function(t){return this._serviceSource=t,this._serviceSource},Ln.prototype.serviceSource=function(){return this._serviceSource},Ln.prototype.fetchConfig=function(t,n,e){e=e||function(){},On.backoff.exponentialBackoff(Dn.makeAjaxRequest.bind(Dn,t,"GET",null),(function(t){var i;try{t=JSON.parse(t),i=!0}catch(r){e.call(e,r)}i&&n&&n.call(n,t)}),e)},Ln.prototype.init=function(t,n,e){if(!this._initCalled){this._initCalled=!0,n=n||function(){};var i=function(){this._initialized=!0,n.call(n)}.bind(this);if(t)this.setDelegate({sources:t}),i();else{this.setCachedSource(this.cachedSource());var r=this.configUrl(),o=function(t){this.setCachedSource(t),this.setServiceSource(t),i()}.bind(this);this.fetchConfig(r,o,e)}}},Ln.prototype.initialize=function(t,n,e){return this.init.apply(this,Array.prototype.slice.call(arguments))},Ln.prototype.initialized=function(){return this._initialized};var Vn,Hn=Ln;On.reflect.attachMethods(Hn,On.config,Hn);var Kn=function(){return Vn},Bn=function(t){Vn=t},qn={eventFields:{applyFieldsMap:function(t,n){var e=Hn.value("fieldsMap",Kn());return On.eventFields.applyFieldsMap(t,n,e)}}},Wn=1500,Xn=100,Yn=2,$n=function(t,n,e){this.delay=t||Xn,this.maxWait="number"==typeof n?n:Wn,this.factor=e||Yn,this.timeWaited=0};$n.prototype.nextDelay=function(){var t=null,n=this.maxWait-this.timeWaited;return n>0&&(this.delay=Math.min(this.delay,n),this.timeWaited+=this.delay),(0===this.maxWait||n>0)&&(t=this.delay,this.delay=this.delay*this.factor),t};var Gn={_backoff:function(t,n,e,i){n.call(n,e,(function(){var r=t.nextDelay();r?setTimeout(Gn._backoff.bind(Gn,t,n,e,i),r):i.apply(i,arguments)}))},exponentialBackoff:function(t,n,e,i,r,o){var s=new $n(i,r,o);Gn._backoff(s,t,n,e)}},Jn=Gn,zn={},Qn={},Zn=function(t){var n={};return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n.name=t.mtName(),n.version=t.mtVersion()),n},te=function(t){var n;return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n=t.mtName()+t.mtVersion()),n},ne={storeDelegateInfo:function(t,n){var e=te(t),i=te(n);e&&i&&(zn[i]||(zn[i]=Zn(n)),zn[e]||(zn[e]=Zn(t),Qn[e]={}),zn[e].delegates?Qn[e][i]||zn[e].delegates.push(zn[i]):zn[e].delegates=[zn[i]],Qn[e][i]=!0)},getStoredDelegateObject:function(t){return zn[te(t)]}},ee={setDelegate:!0},ie={_utResetNonOverridableFunctions:function(){ee={setDelegate:!0}},functionName:function t(){return t.caller.name},shallowClone:function(t){var n,e,i={},r=ie.hasGetterAndSetterMethods(t);for(var o in t)n=null,e=null,r&&(n=t.__lookupGetter__(o),e=t.__lookupSetter__(o)),n||e?(n&&i.__defineGetter__(o,n),e&&i.__defineSetter__(o,e)):i[o]=t[o];return i},isDefined:function(t){return void 0!==t},isDefinedNonNull:function(t){return this.isDefined(t)&&null!==t},isDefinedNonNullNonEmpty:function(t){return ie.isDefinedNonNull(t)&&!ie.isEmptyString(t)&&!ie.isEmptyArray(t)&&!ie.isEmptyObject(t)},isEmptyString:function(t){return ie.isString(t)&&0===t.length},isEmptyArray:function(t){return ie.isArray(t)&&0===t.length},isEmptyObject:function(t){return ie.isObject(t)&&0===Object.keys(t).length},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"number"==typeof t},isInteger:function(t){return ie.isNumber(t)&&t%1==0},isString:function(t){return"string"==typeof t||t instanceof String},isElement:function(t){return t&&1==t.nodeType},isArray:function(t){return t&&t.constructor===Array},isObject:function(t){return t&&t.constructor===Object},values:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&!ie.isFunction(i)&&n.push(i)}return n},keys:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&!ie.isFunction(t[e])&&n.push(e);return n},hasAnyKeys:function(t){for(var n in t)if(t.hasOwnProperty(n))return!0},hasAnyNonNullKeys:function(t){for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0},hasGetterAndSetterMethods:function(t){return ie.isObject(t)&&ie.isFunction(t.__lookupGetter__)&&ie.isFunction(t.__lookupSetter__)&&ie.isFunction(t.__defineGetter__)&&ie.isFunction(t.__defineSetter__)},methods:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&ie.isFunction(i)&&n.push(i)}return n},invert:function(t){var n={};for(var e in t)t.hasOwnProperty(e)&&!ie.isFunction(t[e])&&(n[t[e]]=e);return n},extend:function(){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return this.copyKeysAndValues.apply(this,t)},copyKeysAndValues:function(t,n,e,i){for(var r,o,s,u,a=e&&i||{},c=3;c<arguments.length;c++)for(var f in o=ie.hasGetterAndSetterMethods(r=arguments[c]),r)if(s=null,u=null,o&&(s=r.__lookupGetter__(f),u=r.__lookupSetter__(f)),s||u)s&&a.__defineGetter__(f,s),u&&a.__defineSetter__(f,u);else if(Object.prototype.hasOwnProperty.call(r,f)){var l=r[f];(t||null!=l)&&(n||"function"!=typeof l)&&(a[f]=l)}return a},addNonOverrideableFunctions:function(t){for(var n=0;n<t.length;n++)ee[t[n]]=!0},attachDelegate:function(t,n){var e=!1;if(t&&n&&t!==n){ne.storeDelegateInfo(t,n);var i={};Object.keys(n).forEach((function(n){t[n]||(i[n]=!0)})),ie.extend(i,ee),e=ie.attachMethods(t,n,null,i)}return e},attachMethods:function(t,n,e,i){var r=!1;if(t&&n){i=i||{},e=e||n;var o=function(t,n,e,i){var r=function(){return e[i].apply(t,arguments)};return n&&(r.origFunction=n),r};for(var s in n)if(!(s in i)&&n[s]&&"function"==typeof n[s]){var u=t[s],a=u&&"function"==typeof u?u.bind(t):null;t[s]=o(e,a,n,s),r=!0}}return r},setDelegates:function(t,n){var e={};for(var i in t)n[i]&&ie.isFunction(t[i].setDelegate)&&(e[i]=t[i].setDelegate(n[i]));return e},copyDelegatedFunctions:function(t,n){var e=null;if(t&&n&&n.setDelegate){var i,r={};for(i in t)ie.isFunction(t[i])&&t[i].origFunction&&(r[i]=t[i]);e=n.setDelegate(r)}return e}},re=ie,oe={deResNumber:function(t,n,e){var i=void 0;if(re.isDefined(t))if(re.isDefined(n)||(n=1048576),re.isDefined(e)||(e=2),re.isNumber(t)&&re.isNumber(n)&&n>0&&re.isInteger(e)&&e>=0){var r=Math.pow(10,e);i=Math[t>0?"floor":"ceil"](t/n/r)*r}else i=NaN;return i}},se={disabled:function(t){return!!this.value("disabled",t)},blacklistedEvents:function(t){return this.value("blacklistedEvents",t)||[]},blacklistedFields:function(t){return this.value("blacklistedFields",t)||[]},removeBlacklistedFields:function(t,n){if(t)for(var e=se.blacklistedFields.call(this,n),i=0;i<e.length;i++){var r=e[i];r&&r in t&&delete t[r]}return t},metricsDisabledOrBlacklistedEvent:function(t,n){return se.disabled.call(this,n)||!!t&&se.blacklistedEvents.call(this,n).indexOf(t)>-1},deResFields:function(t){return this.value("deResFields",t)||[]},applyDeRes:function(t,n){var e;return t&&se.deResFields.call(this,n).forEach((function(n){(e=n.fieldName)in t&&(t[e]=oe.deResNumber(t[e],n.magnitude,n.significantDigits))})),t}},ue=se,ae={startsWith:function(t,n,e){var i=!1;return t&&n&&(t=t.substr(0,n.length),e&&(t=t.toLowerCase(),n=n.toLowerCase()),i=0===t.indexOf(n)),i},endsWith:function(t,n,e){var i=!1;if(t&&n){e&&(t=t.toLowerCase(),n=n.toLowerCase());var r=t.length-n.length;i=r>=0&&t.lastIndexOf(n)===r}return i},trim:function(t,n,e){var i=null,r="\t\n\v\f\r             　\u2028\u2029​",o=new RegExp("^["+r+"]+"),s=new RegExp("["+r+"]+$");if(t)if(e||n&&n!=r||!t.trim){var u=null,a=null,c=null;n&&void 0!==n?(u="["+(n=n.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",a=new RegExp("^"+u+"+"),c=new RegExp(u+"+$")):(u=r,a=o,c=s),i=t.replace(a,"").replace(c,"")}else i=t.trim();return i},snakeCaseToCamelCase:function(t,n){var e="";if(t)for(var i,r=t.toLowerCase().split("_"),o=0;o<r.length;o++)i=r[o][0],(0!==o||n)&&(i=i.toUpperCase()),e+=i+r[o].slice(1);return e},snakeCaseToUpperCamelCase:function(t){return ae.snakeCaseToCamelCase(t,!0)},paramString:function(t){var n="",e="",i=!0;for(var r in t){var o=t[r];(o||0===o||!1===o)&&(n+=e+r+"="+encodeURIComponent(o),i&&(e="&",i=!1))}return n},versionStringFromUserAgent:function(t,n){var e=null;n=n||"\\S+";var i=new RegExp("\\b"+n+"/(\\S+)\\b","i").exec(t);return i&&i[1]&&(e=i[1]),e},requestId:function(t){var n=Date.now(),e=Math.floor(1e5*Math.random());return t+"z"+(n=n.toString(36).toUpperCase())+"z"+e.toString(36).toUpperCase()},uuid:function(t){for(var n,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i="",r=0,o=e.length;r<o;r++)i+="x"===(n=e.charAt(r))?ae.randomHexCharacter(t):"y"===n?ae.randomHexCharacter(t,"8","b"):n;return i},randomHexCharacter:function(t,e,i){var r,o=n.crypto||n.msCrypto;return r=t?(16*t()|0).toString(16):o&&o.getRandomValues?(15&o.getRandomValues(new Uint8Array(1))[0]).toString(16):o&&o.randomBytes?o.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),e&&i&&(r<e||r>i)&&(r=ae.randomHexCharacter(t,e,i)),r},weakUUID:function(){return ae.uuid()},convertNumberToBaseAlphabet:function(t,n){var e="",i=n.length;if(i<=36)e=t.toString(i).toUpperCase();else{for(var r,o,s=[];t>0;)o=n.charAt(r=t%i),s.push(o),t=(t-r)/i;e=s.reverse().join("")}return""===e&&(e="0"),e},cryptoRandomBase62String:function(t){var e;if(16777215==Math.floor(4294967295/256)){var i,r,o,s,u,a=n.crypto||n.msCrypto;if(a&&a.getRandomValues)i=a.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),u=!0;else if(a&&a.randomBytes){var c=a.randomBytes(16);i=new Uint32Array(c.buffer,c.byteOffset,c.byteLength/Uint32Array.BYTES_PER_ELEMENT),u=!0}else for(i=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),r=0;r<i.length;r++)i[r]=Math.floor(Math.random()*Math.floor(4294967295));if(i){for(e="",r=0;r<i.length;r++)for(s=i[r],o=0;o<6;o++)e+=ae.base62Alphabet[s%62],s=Math.floor(s/62);t&&(e="1_"+(u?"1":"2")+"_"+e)}}return e},base10Alphabet:"0123456789"};ae.base16Alphabet=ae.base10Alphabet+"ABCDEF",ae.base36Alphabet=ae.base10Alphabet+"ABCDEFGHIJKLMNOPQRSTUVWXYZ",ae.base61Alphabet=ae.base36Alphabet+"abcdefghijklmnopqrstuvwxy",ae.base62Alphabet=ae.base61Alphabet+"z";var ce=ae,fe={setDelegate:function(t){return re.attachDelegate(this,t)},cookie:function(){var t;return"undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes?t=iTunes:"undefined"!=typeof itms&&void 0!==itms.cookie?t=itms:"undefined"!=typeof document&&(t=document),t?t.cookie:void 0},cookieOwnerObject:function(){if("undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes)return iTunes;if("undefined"!=typeof itms&&void 0!==itms.cookie)return itms;if("undefined"!=typeof document)return document;throw"cookies.cookieOwnerObject: No owning object"},get:function(t){var n=this.getUnescaped(t);return n&&(n=unescape(n)),n},getUnescaped:function(t){var n=null,e=this._getRaw();if(e&&t)for(var i=e.split(";"),r=i.length-1;!n&&r>=0;r--){var o=i[r],s=o.indexOf("=");s>0&&(s+1==o.length?n="":ce.trim(o.substring(0,s))==t&&(n=ce.trim(o.substring(s+1))))}return n},remove:function(t,n){return this.setUnescaped(t,".",this.EXPIRE_NOW,null,n)},_getRaw:function(){var t=this.cookie();return re.isString(t)||(t=this.cookieOwnerObject().cookie),t||""},EXPIRE_NOW:-1,EXPIRE_SESSION:null,EXPIRE_ONE_SECOND:1};fe.EXPIRE_ONE_MINUTE=60*fe.EXPIRE_ONE_SECOND,fe.EXPIRE_ONE_HOUR=60*fe.EXPIRE_ONE_MINUTE,fe.EXPIRE_ONE_DAY=24*fe.EXPIRE_ONE_HOUR,fe.EXPIRE_ONE_WEEK=7*fe.EXPIRE_ONE_DAY,fe.EXPIRE_ONE_MONTH=31*fe.EXPIRE_ONE_DAY,fe.EXPIRE_ONE_YEAR=365*fe.EXPIRE_ONE_DAY,fe.EXPIRE_ONE_SIDEREAL_YEAR=365.25*fe.EXPIRE_ONE_DAY,fe.EXPIRE_SIX_MONTHS=180*fe.EXPIRE_ONE_DAY;var le=fe,he={_valueForKeyPath:function(t,n,e){var i=n;if(t&&n)for(var r=t.split("."),o=0;i&&o<r.length;o++){var s=r[o];!(s in i)&&e&&(i[s]={}),i=s in i?i[s]:null}return i},valueForKeyPath:function(t){var n=null;if(t&&arguments.length>1)for(var e=this.sourcesArray(Array.prototype.slice.call(arguments,1)),i=e.length-1;i>=0;i--){var r=e[i];if(n=this._valueForKeyPath(t,r),re.isDefinedNonNull(n))break}return n},createObjectAtKeyPath:function(t,n){return this._valueForKeyPath(t,n,!0)},sourcesArray:function(t){var n=[],e=[];e=e.concat(t),arguments&&arguments.length>1&&(e=e.concat(Array.prototype.slice.call(arguments,1)));for(var i=0;i<e.length;i++){var r=e[i];n=n.concat(r)}return n}},de={mergeAndCleanEventFields:function(){for(var t=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),n=[],e=0;e<t.length;e++){var i=t[e];if(i&&i.constructor===Array)for(var r=0;r<i.length;r++)n.push(i[r]);else n.push(i)}return re.copyKeysAndValues.apply(this,n)},processMetricsData:function(t,n,e,i){var r=this.mergeAndCleanEventFields(i),o=r;if(t&&n){var s={};if(e||(n=n.filter((function(t){return t in r}))),n.length)for(var u=0;u<n.length;u++){var a=n[u],c=t[a];"function"==typeof c&&(s[a]=c.call(t,r))}o=this.mergeAndCleanEventFields(o,s)}return o},applyFieldsMap:function(t,n,e,i){var r,o,s;if(t&&n&&e){var u,a;if(o={},r=he.valueForKeyPath(n,e,e.custom))if(re.isArray(r))for(u=0;u<r.length;++u)re.isDefinedNonNull(a=t[r[u]])&&(o[r[u]]=a);else if("object"==typeof r){for(var c in r)for(u=0;u<r[c].length;++u)if(a=he.valueForKeyPath(r[c][u],t),re.isDefinedNonNull(a)){o[c]=a;break}}else s="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else s="metrics: unable to get "+n+" section from fieldsMap"}else{var f=[];t||f.push("data"),n||f.push("sectionName"),e||f.push("fieldsMap"),s="metrics: missing argument(s): "+f.join(",")+" not provided to applyFieldsMap"}return s&&re.isFunction(i)&&i(s),o}},ve={makeAjaxGetRequest:function(t,n,e){this.makeAjaxRequest(t,"GET",null,n,e)},makeAjaxRequest:function(t,n,e,i,r,o){var s=new XMLHttpRequest;e=e||void 0,o=o||{},i=re.isFunction(i)?i:function(){},r=re.isFunction(r)?r:function(){};var u=!1!==o.async;o.timeout&&u&&(s.timeout=o.timeout),s.onload=function(){s.status>=200&&s.status<300?i(s.response):r(new Error("XHR error: server responded with status "+s.status+" "+s.statusText),s.status)},s.onerror=function(){r(new Error("XHR error"))},s.open(n,t,u),s.withCredentials=!0,s.setRequestHeader("Content-type","application/json"),s.send(e)}},pe={},ge=function(t){pe[t]&&(clearTimeout(pe[t]),pe[t]=null)},ye={_utClearSessions:function(){for(var t in pe)ge(t)},lottery:function(t){return Math.random()<t},sessionSampled:function(t,n,e){var i;if(pe[t])i=!0;else{var r=ye.lottery(n);r&&e>0&&(pe[t]=setTimeout(ge.bind(null,t),e)),i=r}return i},isSampledIn:function(t,n,e,i,r){return n||ye.sessionSampled(t,e,i)||ye.lottery(r)}},me=ye,be="localStorage",Ee="sessionStorage",Se=function(t){var n=null,e=!1;return function(){return t?n=t:(e||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),e=!0),n||(n={storage:{},getItem:function(t){return this.storage[t]},setItem:function(t,n){this.storage[t]=n},removeItem:function(t){delete this.storage[t]}})),n}};function Te(t){var n=null,e=t===be;try{n="undefined"!=(e?typeof localStorage:typeof sessionStorage)?e?localStorage:sessionStorage:null}catch(i){n=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+i)}return n}var Ae={_utDefaultStorageObject:function(t){return Te(t)},localStorageObject:Se(Te(be)),sessionStorageObject:Se(Te(Ee)),saveObjectToStorage:function(t,n,e){var i=null;if(e)try{t.setItem(n,JSON.stringify(e)),i=e}catch(r){}else i=t.removeItem(n);return i},objectFromStorage:function(t,n){var e=null,i=t.getItem(n);if(i)try{e=JSON.parse(i)}catch(r){e=void 0}return e}},Oe={};Oe.backoff=Jn,Oe.config=ue,Oe.cookies=le,Oe.delegatesInfo=ne,Oe.eventFields=de,Oe.keyValue=he,Oe.network=ve,Oe.number=oe,Oe.reflect=re,Oe.sampling=me,Oe.storage=Ae,Oe.string=ce,Oe.optionValueFromStoreFrontHeader=function(t,n){for(var e=null,i="string"==typeof t?t.split(" "):[],r=Oe.string.endsWith(n,":")?n:n+":",o=0;!e&&o<i.length;++o)0===i[o].search(r)&&(e=i[o].slice(r.length));return e};var we=Oe,Ie={setDelegate:function(t){return we.reflect.attachDelegate(this,t)},localStorageObject:we.storage.localStorageObject,sessionStorageObject:we.storage.sessionStorageObject},_e={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(t){return we.reflect.attachDelegate(this,t)},execute:function(t,n,e){var i=t.levelStringToIntMap[n];if(t.level()!==t.NONE&&t.level()<=i){var r=Array.prototype.slice.call(e),o=_e.nonFlagLogArguments(r),s=_e.logOptions(t,i,r),u=s.includeCallStack?(new Error).stack:null,a=u?o.concat("\n"+u):o;if(t[n]._lastLog=a,s.mirrorToServer&&_e.sendToServer(t,n,o,u),s.throwInsteadOfPrint)throw new Error(o.toString());s.suppressClientOutput||(console[n]?console[n].apply(console,a):console.log.apply(console,a))}},isFlagObject:function(t){return t&&t===_e.flagArguments[t.constructor.name]},nonFlagLogArguments:function(t){return t.filter((function(t){return!_e.isFlagObject(t)}))},logOptions:function(t,n,e){var i,r={};return e.forEach((function(t){_e.isFlagObject(t)&&(i=we.string.snakeCaseToCamelCase(t.constructor.name),r[i]=!0)})),we.reflect.isFunction(t.mirrorToServerLevel)&&t.mirrorToServerLevel()!==t.NONE&&t.mirrorToServerLevel()<=n&&(r.mirrorToServer=!0),t.throwLevel()!==t.NONE&&t.throwLevel()<=n&&(r.throwInsteadOfPrint=!0),r},sendToServer:function(){}},Ne=_e,Re={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},ke={loggerName:"defaultLogger",level:Re.INFO,throwLevel:Re.NONE},xe={},Ce=function(t){this._loggerName=t};Ce.loggerNamed=function(t){var n=xe[t=t||ke.loggerName];return n||(n=new Ce(t),xe[t]=n),n},Ce.level=function(){return ke.level},Ce.throwLevel=function(){return ke.throwLevel},we.reflect.extend(Ce.prototype,Re),we.reflect.extend(Ce.prototype,Ne.flagArguments),Ce.prototype.setDelegate=function(t){return we.reflect.attachDelegate(this,t)},Ce.prototype.loggerName=function(){return this._loggerName},Ce.prototype.levelParameterAsInt=function(t){var n,e=null;return we.reflect.isString(t)?n=this.levelStringToIntMap[t.toLowerCase()]:we.reflect.isNumber(t)&&(n=t),n>=this.MIN_LEVEL&&n<=this.MAX_LEVEL&&(e=n),e},Ce.prototype.setLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._level=n)},Ce.prototype.setThrowLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._throwLevel=n)},Ce.prototype.level=function(){var t=this._level;return we.reflect.isNumber(t)?t:Ce.level()},Ce.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},Ce.prototype.throwLevel=function(){var t=this._throwLevel;return we.reflect.isNumber(t)?t:Ce.throwLevel()},Ce.prototype.debug=function(){Ne.execute(this,"debug",arguments)},Ce.prototype.info=function(){Ne.execute(this,"info",arguments)},Ce.prototype.warn=function(){Ne.execute(this,"warn",arguments)},Ce.prototype.error=function(){Ne.execute(this,"error",arguments)},Ce.prototype.lastLog=function(t){return this[t]?this[t]._lastLog:null};var Me=Ce;Me.utils=Ne;var Pe=Me.loggerNamed("mt-client-config"),De={setDelegate:function(t){return we.reflect.attachDelegate(this,t)},makeAjaxRequest:we.network.makeAjaxRequest},je={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},Ue={},Fe=function(t,n,e){if(e){t.push(e);var i=e[n];i&&we.reflect.hasAnyKeys(i)&&t.push(i)}},Le=function(t){this._topic=t,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+je.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+je.compoundSeparator+this._topic};Le.createConfig=function(t,n,e,i){var r=Le.getConfig(t);return t&&"noTopicConfig"!==t&&!r._initCalled&&r.init(n,e,i),r},Le.getConfig=function(t){var n=Ue[t=t||"noTopicConfig"];return n||(n=new Le(t),Ue[t]=n),n},Le.cleanupConfig=function(t){if(t&&Ue[t]){var n=Ue[t];n.setCachedSource(),n.setDebugSource(),delete Ue[t]}},Le.defaultConfig=function(){return Le.getConfig()},Le.value=function(t,n){var e=n&&Ue[n]||Le.defaultConfig();return e.value.call(e,t)},Le.environment=Ie,Le.logger=Pe,Le.network=De,Le.prototype._defaults=function(){return je},Le.prototype._setInitialized=function(t){this._initialized=t},Le.prototype._setInitCalled=function(t){this._initCalled=t},Le.prototype._setShowedDebugWarning=function(t){this._showedDebugWarning=t},Le.prototype._setShowedNoProvidedSourceWarning=function(t){this._showedNoProvidedSourceWarning=t},Le.prototype.setDelegate=function(t){return we.reflect.attachDelegate(this,t)},Le.prototype.topic=function(){return this._topic},Le.prototype.configHostname=function(){},Le.prototype.configUrl=function(){var t,n=this.configHostname();return t=n?"https://"+n+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?t+="/"+this.topic():Le.logger.error("config.configUrl(): Topic must be provided"),t},Le.prototype.sources=function(){},Le.prototype.value=function(t){var n,e=this.cachedSource(),i=this.serviceSource(),r=this.sources(),o=this.debugSource(),s=e||i||r||o;return r||i||t in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,Le.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),o&&(this._showedDebugWarning||(this._showedDebugWarning=!0,Le.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),we.reflect.isArray(r)||(r=[r]),n=0===t.indexOf("blacklisted")?s?[e,i,r,o]:[je]:[je,e,i,r,o],n=this.configSourcesWithOverrides(n,this.topic()),we.keyValue.valueForKeyPath.apply(we.keyValue,[t].concat(n))},Le.prototype.configSourcesWithOverrides=function(t,n){var e=t;if(t&&t.length&&n){e=[];for(var i=0;i<t.length;i++){var r=t[i];if(r)if(we.reflect.isArray(r)&&r.length){for(var o=[],s=0;s<r.length;s++)Fe(o,n,r[s]);e.push(o)}else Fe(e,n,r)}}return e},Le.prototype.setDebugSource=function(t){return this._debugSource=t||null,we.storage.saveObjectToStorage(Le.environment.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},Le.prototype.debugSource=function(){return this._debugSource||(this._debugSource=we.storage.objectFromStorage(Le.environment.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},Le.prototype.setCachedSource=function(t){return this._cachedSource=t||null,we.storage.saveObjectToStorage(Le.environment.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},Le.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=we.storage.objectFromStorage(Le.environment.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},Le.prototype.setServiceSource=function(t){return this._serviceSource=t,this._serviceSource},Le.prototype.serviceSource=function(){return this._serviceSource},Le.prototype.fetchConfig=function(t,n,e){e=e||function(){},we.backoff.exponentialBackoff(De.makeAjaxRequest.bind(De,t,"GET",null),(function(t){var i;try{t=JSON.parse(t),i=!0}catch(r){e.call(e,r)}i&&n&&n.call(n,t)}),e)},Le.prototype.init=function(t,n,e){if(!this._initCalled){this._initCalled=!0,n=n||function(){};var i=function(){this._initialized=!0,n.call(n)}.bind(this);if(t)this.setDelegate({sources:t}),i();else{this.setCachedSource(this.cachedSource());var r=this.configUrl(),o=function(t){this.setCachedSource(t),this.setServiceSource(t),i()}.bind(this);this.fetchConfig(r,o,e)}}},Le.prototype.initialize=function(t,n,e){return this.init.apply(this,Array.prototype.slice.call(arguments))},Le.prototype.initialized=function(){return this._initialized};var Ve=Le,He={CLIENT_EVENT_ID:"clientEventId",DELEGATE_APP:"delegateApp",ENVIRONMENT_INSTANCE:"environmentInstance",STOREFRONT_COUNTRY_CODE:"storeFrontCountryCode"},Ke=function(t){this.setDelegate({topic:t})};Ke.prototype._exceptionString=function(t){return"The function eventHandlers.base."+t+"() must be overridden with a Kit-specific delegate function."},Ke.prototype.setDelegate=function(t){return we.reflect.attachDelegate(this,t)},Ke.prototype.topic=function(){throw this._exceptionString(we.reflect.functionName())},Ke.prototype.environment=function(){throw this._exceptionString(we.reflect.functionName())},Ke.prototype.eventRecorder=function(){throw this._exceptionString(we.reflect.functionName())},Ke.prototype.metricsData=function(){throw this._exceptionString(we.reflect.functionName())},Ke.prototype.processMetricsData=function(){throw this._exceptionString(we.reflect.functionName())},Ke.prototype.knownFields=function(){return["app","appVersion","baseVersion","capacityData","capacityDataAvailable","capacityDisk","capacitySystem","capacitySystemAvailable","connection","constraintProfile",He.DELEGATE_APP,"environmentInstance","eventTime","isSignedIn","hostApp","hostAppVersion","osVersion","pixelRatio","resourceRevNum","screenHeight","screenWidth","storeFrontHeader","timezoneOffset","userAgent","userType","windowInnerHeight","windowInnerWidth","windowOuterHeight","windowOuterWidth","xpPostFrequency","xpSendMethod"]},Ke.prototype.app=function(t){return t&&t.app||this.environment().app()},Ke.prototype.appVersion=function(t){return t&&t.appVersion||this.environment().appVersion()},Ke.prototype.baseVersion=function(){return 1},Ke.prototype.capacityData=function(t){return t&&t.capacityData||this.environment().capacityData()},Ke.prototype.capacityDataAvailable=function(t){return t&&t.capacityDataAvailable||this.environment().capacityDataAvailable()},Ke.prototype.capacityDisk=function(t){return t&&t.capacityDisk||this.environment().capacityDisk()},Ke.prototype.capacitySystem=function(t){return t&&t.capacitySystem||this.environment().capacitySystem()},Ke.prototype.capacitySystemAvailable=function(t){return t&&t.capacitySystemAvailable||this.environment().capacitySystemAvailable()},Ke.prototype.clientEventId=function(t){return t&&t[He.CLIENT_EVENT_ID]||we.string.uuid()},Ke.prototype.clientId=function(t){return t&&t.clientId||this.environment().clientId()},Ke.prototype.connection=function(t){return t&&t.connection||this.environment().connectionType()},Ke.prototype.constraintProfile=function(t){return t&&t.constraintProfile||we.reflect.isFunction(Ve.constraintProfile)&&Ve.constraintProfile(this.topic())},Ke.prototype.delegateApp=function(t){return t&&t[He.DELEGATE_APP]||this.environment().delegateApp()},Ke.prototype.dsId=function(t){return t&&t.dsId||this.environment().dsId()},Ke.prototype.environmentDataCenter=function(t){return t&&t[He.ENVIRONMENT_DATA_CENTER]||this.environment().environmentDataCenter()},Ke.prototype.environmentInstance=function(t){return t&&t[He.ENVIRONMENT_INSTANCE]||this.environment().environmentInstance()},Ke.prototype.eventTime=function(t){return t&&t.eventTime||Date.now()},Ke.prototype.hardwareBrand=function(t){return t&&t.hardwareBrand||this.environment().hardwareBrand()},Ke.prototype.hardwareFamily=function(t){return t&&t.hardwareFamily||this.environment().hardwareFamily()},Ke.prototype.hardwareModel=function(t){return t&&t.hardwareModel||this.environment().hardwareModel()},Ke.prototype.hostApp=function(t){return t&&t.hostApp||this.environment().hostApp()},Ke.prototype.hostAppVersion=function(t){return t&&t.hostAppVersion||this.environment().hostAppVersion()},Ke.prototype.os=function(t){return t&&t.os||this.environment().os()},Ke.prototype.osBuildNumber=function(t){return t&&t.osBuildNumber||this.environment().osBuildNumber()},Ke.prototype.osLanguages=function(t){return t&&t.osBuildNumber||this.environment().osLanguages()},Ke.prototype.osVersion=function(t){return t&&t.osVersion||this.environment().osVersion()},Ke.prototype.page=function(t){var n=null;if(t)return t.page?n=t.page:this.pageType(t)&&this.pageId(t)&&(n=this.pageType(t)+Ve.value("compoundSeparator",this.topic())+this.pageId(t)),n;throw"No data provided to event_handlers/base page function"},Ke.prototype.pageContext=function(t){return t&&t.pageContext},Ke.prototype.pageDetails=function(t){return t&&t.pageDetails},Ke.prototype.pageId=function(t){return t&&t.pageId},Ke.prototype.pageType=function(t){return t&&t.pageType},Ke.prototype.pageUrl=function(t){return t&&t.pageUrl||this.environment().pageUrl()},Ke.prototype.parentPageUrl=function(t){return t&&t.parentPageUrl||this.environment().parentPageUrl()},Ke.prototype.pixelRatio=function(t){return t&&t.pixelRatio||this.environment().pixelRatio()},Ke.prototype.resourceRevNum=function(t){return t&&t.resourceRevNum||this.environment().resourceRevNum()},Ke.prototype.screenHeight=function(t){return t&&t.screenHeight||this.environment().screenHeight()},Ke.prototype.screenWidth=function(t){return t&&t.screenWidth||this.environment().screenWidth()},Ke.prototype.storeFrontCountryCode=function(t){return t&&t[He.STOREFRONT_COUNTRY_CODE]||this.environment().storeFrontCountryCode()},Ke.prototype.storeFrontHeader=function(t){return t&&t.storeFrontHeader||this.environment().storeFrontHeader()},Ke.prototype.timezoneOffset=function(t){return t&&t.timezoneOffset||(new Date).getTimezoneOffset()},Ke.prototype.userAgent=function(t){return t&&t.userAgent||this.environment().userAgent()},Ke.prototype.userType=function(t){return t&&t.userType||this.environment().userType()},Ke.prototype.windowInnerHeight=function(t){return t&&t.windowInnerHeight||this.environment().windowInnerHeight()},Ke.prototype.windowInnerWidth=function(t){return t&&t.windowInnerWidth||this.environment().windowInnerWidth()},Ke.prototype.windowOuterHeight=function(t){return t&&t.windowOuterHeight||this.environment().windowOuterHeight()},Ke.prototype.windowOuterWidth=function(t){return t&&t.windowOuterWidth||this.environment().windowOuterWidth()},Ke.prototype.xpPostFrequency=function(t){return t&&t.xpPostFrequency||Ve.value("postFrequency",this.topic())},Ke.prototype.xpSendMethod=function(t){return t&&t.xpSendMethod||this.eventRecorder().sendMethod()};var Be={Base:Ke},qe=function(){};qe.prototype._exceptionString=function(t){return"The function system.environment."+t+"() must be overridden with a platform-specific delegate function.If you have no data for this field, have your delegate return null or undefined (no 'return')"},qe.prototype.setDelegate=function(t){return we.cookies.setDelegate(t),we.reflect.attachDelegate(this,t)},qe.prototype.app=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.appVersion=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.capacityData=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.capacityDataAvailable=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.capacityDisk=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.capacitySystem=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.capacitySystemAvailable=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.clientId=function(){},qe.prototype.connectionType=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.delegateApp=function(){},qe.prototype.dsId=function(){},qe.prototype.environmentInstance=function(){},qe.prototype.hardwareBrand=function(){},qe.prototype.hardwareFamily=function(){},qe.prototype.hardwareModel=function(){},qe.prototype.hostApp=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.hostAppVersion=function(){},qe.prototype.os=function(){},qe.prototype.osBuildNumber=function(){},qe.prototype.osLanguages=function(){},qe.prototype.osVersion=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.pageUrl=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.parentPageUrl=function(){},qe.prototype.pixelRatio=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.resourceRevNum=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.screenHeight=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.screenWidth=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.storeFrontCountryCode=function(){},qe.prototype.storeFrontHeader=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.userAgent=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.userType=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.windowInnerHeight=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.windowInnerWidth=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.windowOuterHeight=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.windowOuterWidth=function(){throw this._exceptionString(we.reflect.functionName())},qe.prototype.localStorageObject=we.storage.localStorageObject,qe.prototype.sessionStorageObject=we.storage.sessionStorageObject;var We={Environment:qe},Xe=function(){this._eventData={}};Xe.prototype.updateData=function(){we.reflect.extend.apply(we.reflect,[this._eventData].concat(Array.prototype.slice.call(arguments)))};var Ye=Be,$e={MetricsData:Xe},Ge=We.Environment,Je=function(){Ge.apply(this,arguments)};(Je.prototype=new Ge).constructor=Je;var ze=new Je;Je.prototype.consumerId=function(){},Je.prototype.consumerNs=function(){},Je.prototype.isOffline=function(){},Je.prototype.videoViewportHeight=function(){},Je.prototype.videoViewportWidth=function(){};var Qe=ze,Ze={setDelegate:function(t){return On.reflect.attachDelegate(this,t)},globalScope:function(){return n}},ti=Mn.loggerNamed("mt-event-queue"),ni={setDelegate:function(t){return On.reflect.attachDelegate(this,t)},makeAjaxRequest:On.network.makeAjaxRequest},ei={AJAX:"ajax",AJAX_SYNCHRONOUS:"ajaxSynchronous",IMAGE:"image"},ii=On.reflect,ri=ei,oi={DEFAULT_REQUEST_TIMEOUT:1e4,EVENTS_KEY:"events",EVENT_DELIVERY_VERSION:"1.0",MAX_PERSISTENT_QUEUE_SIZE:100,RETRY_EXPONENT_BASE:2,SEND_METHOD:ri,URL_DELIVERY_VERSION:2,eventQueues:{},postIntervalEnabled:!0,enqueueEvent:function(t,n){var e=null;if(t&&n){oi.eventQueues=oi.eventQueues||{},oi.eventQueues[t]=oi.eventQueues[t]||{},oi.eventQueues[t][oi.EVENTS_KEY]=oi.eventQueues[t][oi.EVENTS_KEY]||[],oi.eventQueues[t][oi.EVENTS_KEY].push(n),e=n;var i=Hn.value("maxPersistentQueueSize",t)||oi.MAX_PERSISTENT_QUEUE_SIZE;oi.trimEventQueues(oi.eventQueues,i)}return e},trimEventQueues:function(t,n){var e=Object.keys(t);e.length&&e.forEach((function(e){var i=t[e][oi.EVENTS_KEY];i&&i.length&&i.length>n&&(ti.warn("eventQueue overflow, deleting LRU events: size is: "+i.length+" which is over max size: "+n),t[e][oi.EVENTS_KEY]=i.slice(-n))}))},resetTopicQueue:function(t){oi.eventQueues[t]&&(oi.eventQueues[t][oi.EVENTS_KEY]=null)},resetTopicRetryAttempts:function(t){oi.eventQueues[t]&&(oi.eventQueues[t].retryAttempts=0)},scheduleNextTopicRetryAttempt:function(t){if(oi.eventQueues[t]&&this.postIntervalEnabled){oi.eventQueues[t].retryAttempts=oi.eventQueues[t].retryAttempts||0,oi.eventQueues[t].retryAttempts++;var n=Math.pow(oi.RETRY_EXPONENT_BASE,oi.eventQueues[t].retryAttempts)*Hn.value("postFrequency",t);oi.resetTopicPostInterval(t),oi.setTopicPostInterval(t,n)}},sendEvents:function(t,n){for(var e in oi.eventQueues)oi.sendEventsForTopic(e,t,n)},sendEventsForTopic:function(t,n,e){var i=oi.eventQueues[t],r=Hn.value("testExponentialBackoff",t),o=Hn.value("metricsUrl",t),s=On.config.disabled.call(Hn);if(i&&o&&!s&&!r&&(!i.retryAttempts||!e))switch(oi.resetTopicPostInterval(t),oi.setTopicPostInterval(t,Hn.value("postFrequency",t)),n){case oi.SEND_METHOD.IMAGE:oi.sendEventsViaImage(t);break;case oi.SEND_METHOD.AJAX_SYNCHRONOUS:oi.sendEventsViaAjax(t,!1);break;case oi.SEND_METHOD.AJAX:default:oi.sendEventsViaAjax(t,!0)}r&&oi.scheduleNextTopicRetryAttempt(t)},sendEventsViaImage:function(t){if(oi.eventQueues[t]){var n=oi.metricsUrlForTopic(t),e=-1==n.indexOf("?")?"?":"&",i=n+e+"responseType=image",r=oi.eventQueues[t][oi.EVENTS_KEY];r&&r.length&&r.forEach((function(t){var n=oi.createQueryParams(t);if(n){var e=i+"&"+n;(new Image).src=e}})),oi.resetTopicQueue(t)}},createQueryParams:function(t){var n,e,i="";return Object.keys(t).forEach((function(r,o,s){e=ii.isString(n=t[r])?n:JSON.stringify(n),i+=r+"="+encodeURIComponent(e),o<s.length-1&&(i+="&")})),i.length?i:null},sendEventsViaAjax:function(t,n){if(oi.eventQueues[t]&&oi.eventQueues[t][oi.EVENTS_KEY]){var e=oi.enrichAndSerializeEvents(oi.eventQueues[t][oi.EVENTS_KEY]);if(e){var i=oi.metricsUrlForTopic(t),r=function(){oi.resetTopicQueue(t),oi.resetTopicRetryAttempts(t)},o=Hn.value("requestTimeout",t)||oi.DEFAULT_REQUEST_TIMEOUT;o=Math.min(o,Hn.value("postFrequency",t)),ni.makeAjaxRequest(i,"POST",e,r,(function(n,e){e>=400&&e<500?r():oi.scheduleNextTopicRetryAttempt(t)}),{async:n,timeout:o})}}},enrichAndSerializeEvents:function(t){var n=null;if(t&&t.length){var e={};e.deliveryVersion=oi.EVENT_DELIVERY_VERSION,e.postTime=Date.now(),e[oi.EVENTS_KEY]=t;try{n=JSON.stringify(e)}catch(i){ti.error("Error stringifying events as JSON: "+i)}}return n},metricsUrlForTopic:function(t){return Hn.value("metricsUrl",t)+"/"+oi.URL_DELIVERY_VERSION+"/"+t},setTopicPostInterval:function(t,n){oi.eventQueues[t]&&n&&this.postIntervalEnabled&&(this.resetTopicPostInterval(t),oi.eventQueues[t].postIntervalToken=Ze.globalScope().setInterval((function(){ti.debug("MetricsKit: triggering postIntervalTimer for "+t+" at "+(new Date).toString()),oi.sendEventsForTopic.call(oi,t)}),n))},resetTopicPostInterval:function(t){oi.eventQueues[t]&&(Ze.globalScope().clearInterval(oi.eventQueues[t].postIntervalToken),oi.eventQueues[t].postIntervalToken=null)},resetQueuePostIntervals:function(){for(var t in oi.eventQueues)oi.resetTopicPostInterval(t)},setQueuePostIntervals:function(){for(var t in oi.eventQueues){var n=oi.eventQueues[t][oi.EVENTS_KEY];n&&n.length&&oi.setTopicPostInterval(t,Hn.value("postFrequency",t))}}},si={_objectContainsValue:function(t,n){var e=!1;for(var i in t){var r=t[i];if(t.hasOwnProperty(i)&&!ii.isFunction(r)&&r===n){e=!0;break}}return e},_utQueue:function(){return oi},setPostIntervalEnabled:function(t){oi.postIntervalEnabled=t,t?oi.setQueuePostIntervals():oi.resetQueuePostIntervals()},recordEvent:function(t,n,e){On.config.disabled.call(Hn)||(0===Hn.value("postFrequency",t)&&(e=!0),oi.enqueueEvent(t,n),e?oi.sendEvents(oi.SEND_METHOD.AJAX,!0):!oi.eventQueues[t].postIntervalToken&&oi.postIntervalEnabled&&oi.setTopicPostInterval(t,Hn.value("postFrequency",t)))},flushUnreportedEvents:function(t,n){var e;t?ii.isString(n)&&this._objectContainsValue(ri,n)?oi.sendEvents(n,!0):(e=navigator.userAgent,/iPad|iPhone|iPod/.test(e)&&-1==e.indexOf("IEMobile")?oi.sendEvents(oi.SEND_METHOD.AJAX_SYNCHRONOUS,!0):oi.sendEvents(oi.SEND_METHOD.IMAGE,!0)):oi.sendEvents(oi.SEND_METHOD.AJAX,!0)}},ui={_utResetQueue:function(){for(var t in si._utQueue().eventQueues)si._utQueue().resetTopicPostInterval(t);si._utQueue().eventQueues={}},SEND_METHOD:ei,setDelegate:function(t){return On.reflect.attachDelegate(this,t)},recordEvent:function(t,n,e){var i=null;return n&&!On.config.metricsDisabledOrBlacklistedEvent.call(Hn,n.eventType,t)&&(On.config.removeBlacklistedFields.call(Hn,n,t),si.recordEvent(t,n,e),i=n),i},flushUnreportedEvents:function(t,n){si.flushUnreportedEvents(t,n)},sendMethod:function(){return"javascript"}},ai=1500,ci=100,fi=2,li=function(t,n,e){this.delay=t||ci,this.maxWait="number"==typeof n?n:ai,this.factor=e||fi,this.timeWaited=0};li.prototype.nextDelay=function(){var t=null,n=this.maxWait-this.timeWaited;return n>0&&(this.delay=Math.min(this.delay,n),this.timeWaited+=this.delay),(0===this.maxWait||n>0)&&(t=this.delay,this.delay=this.delay*this.factor),t};var hi={_backoff:function(t,n,e,i){n.call(n,e,(function(){var r=t.nextDelay();r?setTimeout(hi._backoff.bind(hi,t,n,e,i),r):i.apply(i,arguments)}))},exponentialBackoff:function(t,n,e,i,r,o){var s=new li(i,r,o);hi._backoff(s,t,n,e)}},di=hi,vi={},pi={},gi=function(t){var n={};return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n.name=t.mtName(),n.version=t.mtVersion()),n},yi=function(t){var n;return"function"==typeof t.mtName&&"function"==typeof t.mtVersion&&(n=t.mtName()+t.mtVersion()),n},mi={storeDelegateInfo:function(t,n){var e=yi(t),i=yi(n);e&&i&&(vi[i]||(vi[i]=gi(n)),vi[e]||(vi[e]=gi(t),pi[e]={}),vi[e].delegates?pi[e][i]||vi[e].delegates.push(vi[i]):vi[e].delegates=[vi[i]],pi[e][i]=!0)},getStoredDelegateObject:function(t){return vi[yi(t)]}},bi={setDelegate:!0},Ei={_utResetNonOverridableFunctions:function(){bi={setDelegate:!0}},functionName:function t(){return t.caller.name},shallowClone:function(t){var n,e,i={},r=Ei.hasGetterAndSetterMethods(t);for(var o in t)n=null,e=null,r&&(n=t.__lookupGetter__(o),e=t.__lookupSetter__(o)),n||e?(n&&i.__defineGetter__(o,n),e&&i.__defineSetter__(o,e)):i[o]=t[o];return i},isDefined:function(t){return void 0!==t},isDefinedNonNull:function(t){return this.isDefined(t)&&null!==t},isDefinedNonNullNonEmpty:function(t){return Ei.isDefinedNonNull(t)&&!Ei.isEmptyString(t)&&!Ei.isEmptyArray(t)&&!Ei.isEmptyObject(t)},isEmptyString:function(t){return Ei.isString(t)&&0===t.length},isEmptyArray:function(t){return Ei.isArray(t)&&0===t.length},isEmptyObject:function(t){return Ei.isObject(t)&&0===Object.keys(t).length},isFunction:function(t){return"function"==typeof t},isNumber:function(t){return"number"==typeof t},isInteger:function(t){return Ei.isNumber(t)&&t%1==0},isString:function(t){return"string"==typeof t||t instanceof String},isElement:function(t){return t&&1==t.nodeType},isArray:function(t){return t&&t.constructor===Array},isObject:function(t){return t&&t.constructor===Object},values:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&!Ei.isFunction(i)&&n.push(i)}return n},keys:function(t){var n=[];for(var e in t)t.hasOwnProperty(e)&&!Ei.isFunction(t[e])&&n.push(e);return n},hasAnyKeys:function(t){for(var n in t)if(t.hasOwnProperty(n))return!0},hasAnyNonNullKeys:function(t){for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0},hasGetterAndSetterMethods:function(t){return Ei.isObject(t)&&Ei.isFunction(t.__lookupGetter__)&&Ei.isFunction(t.__lookupSetter__)&&Ei.isFunction(t.__defineGetter__)&&Ei.isFunction(t.__defineSetter__)},methods:function(t){var n=[];for(var e in t){var i=t[e];t.hasOwnProperty(e)&&Ei.isFunction(i)&&n.push(i)}return n},invert:function(t){var n={};for(var e in t)t.hasOwnProperty(e)&&!Ei.isFunction(t[e])&&(n[t[e]]=e);return n},extend:function(){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return this.copyKeysAndValues.apply(this,t)},copyKeysAndValues:function(t,n,e,i){for(var r,o,s,u,a=e&&i||{},c=3;c<arguments.length;c++)for(var f in o=Ei.hasGetterAndSetterMethods(r=arguments[c]),r)if(s=null,u=null,o&&(s=r.__lookupGetter__(f),u=r.__lookupSetter__(f)),s||u)s&&a.__defineGetter__(f,s),u&&a.__defineSetter__(f,u);else if(Object.prototype.hasOwnProperty.call(r,f)){var l=r[f];(t||null!=l)&&(n||"function"!=typeof l)&&(a[f]=l)}return a},addNonOverrideableFunctions:function(t){for(var n=0;n<t.length;n++)bi[t[n]]=!0},attachDelegate:function(t,n){var e=!1;if(t&&n&&t!==n){mi.storeDelegateInfo(t,n);var i={};Object.keys(n).forEach((function(n){t[n]||(i[n]=!0)})),Ei.extend(i,bi),e=Ei.attachMethods(t,n,null,i)}return e},attachMethods:function(t,n,e,i){var r=!1;if(t&&n){i=i||{},e=e||n;var o=function(t,n,e,i){var r=function(){return e[i].apply(t,arguments)};return n&&(r.origFunction=n),r};for(var s in n)if(!(s in i)&&n[s]&&"function"==typeof n[s]){var u=t[s],a=u&&"function"==typeof u?u.bind(t):null;t[s]=o(e,a,n,s),r=!0}}return r},setDelegates:function(t,n){var e={};for(var i in t)n[i]&&Ei.isFunction(t[i].setDelegate)&&(e[i]=t[i].setDelegate(n[i]));return e},copyDelegatedFunctions:function(t,n){var e=null;if(t&&n&&n.setDelegate){var i,r={};for(i in t)Ei.isFunction(t[i])&&t[i].origFunction&&(r[i]=t[i]);e=n.setDelegate(r)}return e}},Si=Ei,Ti={deResNumber:function(t,n,e){var i=void 0;if(Si.isDefined(t))if(Si.isDefined(n)||(n=1048576),Si.isDefined(e)||(e=2),Si.isNumber(t)&&Si.isNumber(n)&&n>0&&Si.isInteger(e)&&e>=0){var r=Math.pow(10,e);i=Math[t>0?"floor":"ceil"](t/n/r)*r}else i=NaN;return i}},Ai={disabled:function(t){return!!this.value("disabled",t)},blacklistedEvents:function(t){return this.value("blacklistedEvents",t)||[]},blacklistedFields:function(t){return this.value("blacklistedFields",t)||[]},removeBlacklistedFields:function(t,n){if(t)for(var e=Ai.blacklistedFields.call(this,n),i=0;i<e.length;i++){var r=e[i];r&&r in t&&delete t[r]}return t},metricsDisabledOrBlacklistedEvent:function(t,n){return Ai.disabled.call(this,n)||!!t&&Ai.blacklistedEvents.call(this,n).indexOf(t)>-1},deResFields:function(t){return this.value("deResFields",t)||[]},applyDeRes:function(t,n){var e;return t&&Ai.deResFields.call(this,n).forEach((function(n){(e=n.fieldName)in t&&(t[e]=Ti.deResNumber(t[e],n.magnitude,n.significantDigits))})),t}},Oi=Ai,wi={startsWith:function(t,n,e){var i=!1;return t&&n&&(t=t.substr(0,n.length),e&&(t=t.toLowerCase(),n=n.toLowerCase()),i=0===t.indexOf(n)),i},endsWith:function(t,n,e){var i=!1;if(t&&n){e&&(t=t.toLowerCase(),n=n.toLowerCase());var r=t.length-n.length;i=r>=0&&t.lastIndexOf(n)===r}return i},trim:function(t,n,e){var i=null,r="\t\n\v\f\r             　\u2028\u2029​",o=new RegExp("^["+r+"]+"),s=new RegExp("["+r+"]+$");if(t)if(e||n&&n!=r||!t.trim){var u=null,a=null,c=null;n&&void 0!==n?(u="["+(n=n.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",a=new RegExp("^"+u+"+"),c=new RegExp(u+"+$")):(u=r,a=o,c=s),i=t.replace(a,"").replace(c,"")}else i=t.trim();return i},snakeCaseToCamelCase:function(t,n){var e="";if(t)for(var i,r=t.toLowerCase().split("_"),o=0;o<r.length;o++)i=r[o][0],(0!==o||n)&&(i=i.toUpperCase()),e+=i+r[o].slice(1);return e},snakeCaseToUpperCamelCase:function(t){return wi.snakeCaseToCamelCase(t,!0)},paramString:function(t){var n="",e="",i=!0;for(var r in t){var o=t[r];(o||0===o||!1===o)&&(n+=e+r+"="+encodeURIComponent(o),i&&(e="&",i=!1))}return n},versionStringFromUserAgent:function(t,n){var e=null;n=n||"\\S+";var i=new RegExp("\\b"+n+"/(\\S+)\\b","i").exec(t);return i&&i[1]&&(e=i[1]),e},requestId:function(t){var n=Date.now(),e=Math.floor(1e5*Math.random());return t+"z"+(n=n.toString(36).toUpperCase())+"z"+e.toString(36).toUpperCase()},uuid:function(t){for(var n,e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",i="",r=0,o=e.length;r<o;r++)i+="x"===(n=e.charAt(r))?wi.randomHexCharacter(t):"y"===n?wi.randomHexCharacter(t,"8","b"):n;return i},randomHexCharacter:function(t,e,i){var r,o=n.crypto||n.msCrypto;return r=t?(16*t()|0).toString(16):o&&o.getRandomValues?(15&o.getRandomValues(new Uint8Array(1))[0]).toString(16):o&&o.randomBytes?o.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),e&&i&&(r<e||r>i)&&(r=wi.randomHexCharacter(t,e,i)),r},weakUUID:function(){return wi.uuid()},convertNumberToBaseAlphabet:function(t,n){var e="",i=n.length;if(i<=36)e=t.toString(i).toUpperCase();else{for(var r,o,s=[];t>0;)o=n.charAt(r=t%i),s.push(o),t=(t-r)/i;e=s.reverse().join("")}return""===e&&(e="0"),e},cryptoRandomBase62String:function(t){var e;if(16777215==Math.floor(4294967295/256)){var i,r,o,s,u,a=n.crypto||n.msCrypto;if(a&&a.getRandomValues)i=a.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),u=!0;else if(a&&a.randomBytes){var c=a.randomBytes(16);i=new Uint32Array(c.buffer,c.byteOffset,c.byteLength/Uint32Array.BYTES_PER_ELEMENT),u=!0}else for(i=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),r=0;r<i.length;r++)i[r]=Math.floor(Math.random()*Math.floor(4294967295));if(i){for(e="",r=0;r<i.length;r++)for(s=i[r],o=0;o<6;o++)e+=wi.base62Alphabet[s%62],s=Math.floor(s/62);t&&(e="1_"+(u?"1":"2")+"_"+e)}}return e},base10Alphabet:"0123456789"};wi.base16Alphabet=wi.base10Alphabet+"ABCDEF",wi.base36Alphabet=wi.base10Alphabet+"ABCDEFGHIJKLMNOPQRSTUVWXYZ",wi.base61Alphabet=wi.base36Alphabet+"abcdefghijklmnopqrstuvwxy",wi.base62Alphabet=wi.base61Alphabet+"z";var Ii=wi,_i={setDelegate:function(t){return Si.attachDelegate(this,t)},cookie:function(){var t;return"undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes?t=iTunes:"undefined"!=typeof itms&&void 0!==itms.cookie?t=itms:"undefined"!=typeof document&&(t=document),t?t.cookie:void 0},cookieOwnerObject:function(){if("undefined"!=typeof window&&"iTunes"in window&&"cookie"in iTunes)return iTunes;if("undefined"!=typeof itms&&void 0!==itms.cookie)return itms;if("undefined"!=typeof document)return document;throw"cookies.cookieOwnerObject: No owning object"},get:function(t){var n=this.getUnescaped(t);return n&&(n=unescape(n)),n},getUnescaped:function(t){var n=null,e=this._getRaw();if(e&&t)for(var i=e.split(";"),r=i.length-1;!n&&r>=0;r--){var o=i[r],s=o.indexOf("=");s>0&&(s+1==o.length?n="":Ii.trim(o.substring(0,s))==t&&(n=Ii.trim(o.substring(s+1))))}return n},remove:function(t,n){return this.setUnescaped(t,".",this.EXPIRE_NOW,null,n)},_getRaw:function(){var t=this.cookie();return Si.isString(t)||(t=this.cookieOwnerObject().cookie),t||""},EXPIRE_NOW:-1,EXPIRE_SESSION:null,EXPIRE_ONE_SECOND:1};_i.EXPIRE_ONE_MINUTE=60*_i.EXPIRE_ONE_SECOND,_i.EXPIRE_ONE_HOUR=60*_i.EXPIRE_ONE_MINUTE,_i.EXPIRE_ONE_DAY=24*_i.EXPIRE_ONE_HOUR,_i.EXPIRE_ONE_WEEK=7*_i.EXPIRE_ONE_DAY,_i.EXPIRE_ONE_MONTH=31*_i.EXPIRE_ONE_DAY,_i.EXPIRE_ONE_YEAR=365*_i.EXPIRE_ONE_DAY,_i.EXPIRE_ONE_SIDEREAL_YEAR=365.25*_i.EXPIRE_ONE_DAY,_i.EXPIRE_SIX_MONTHS=180*_i.EXPIRE_ONE_DAY;var Ni=_i,Ri={_valueForKeyPath:function(t,n,e){var i=n;if(t&&n)for(var r=t.split("."),o=0;i&&o<r.length;o++){var s=r[o];!(s in i)&&e&&(i[s]={}),i=s in i?i[s]:null}return i},valueForKeyPath:function(t){var n=null;if(t&&arguments.length>1)for(var e=this.sourcesArray(Array.prototype.slice.call(arguments,1)),i=e.length-1;i>=0;i--){var r=e[i];if(n=this._valueForKeyPath(t,r),Si.isDefinedNonNull(n))break}return n},createObjectAtKeyPath:function(t,n){return this._valueForKeyPath(t,n,!0)},sourcesArray:function(t){var n=[],e=[];e=e.concat(t),arguments&&arguments.length>1&&(e=e.concat(Array.prototype.slice.call(arguments,1)));for(var i=0;i<e.length;i++){var r=e[i];n=n.concat(r)}return n}},ki={mergeAndCleanEventFields:function(){for(var t=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),n=[],e=0;e<t.length;e++){var i=t[e];if(i&&i.constructor===Array)for(var r=0;r<i.length;r++)n.push(i[r]);else n.push(i)}return Si.copyKeysAndValues.apply(this,n)},processMetricsData:function(t,n,e,i){var r=this.mergeAndCleanEventFields(i),o=r;if(t&&n){var s={};if(e||(n=n.filter((function(t){return t in r}))),n.length)for(var u=0;u<n.length;u++){var a=n[u],c=t[a];"function"==typeof c&&(s[a]=c.call(t,r))}o=this.mergeAndCleanEventFields(o,s)}return o},applyFieldsMap:function(t,n,e,i){var r,o,s;if(t&&n&&e){var u,a;if(o={},r=Ri.valueForKeyPath(n,e,e.custom))if(Si.isArray(r))for(u=0;u<r.length;++u)Si.isDefinedNonNull(a=t[r[u]])&&(o[r[u]]=a);else if("object"==typeof r){for(var c in r)for(u=0;u<r[c].length;++u)if(a=Ri.valueForKeyPath(r[c][u],t),Si.isDefinedNonNull(a)){o[c]=a;break}}else s="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else s="metrics: unable to get "+n+" section from fieldsMap"}else{var f=[];t||f.push("data"),n||f.push("sectionName"),e||f.push("fieldsMap"),s="metrics: missing argument(s): "+f.join(",")+" not provided to applyFieldsMap"}return s&&Si.isFunction(i)&&i(s),o}},xi={makeAjaxGetRequest:function(t,n,e){this.makeAjaxRequest(t,"GET",null,n,e)},makeAjaxRequest:function(t,n,e,i,r,o){var s=new XMLHttpRequest;e=e||void 0,o=o||{},i=Si.isFunction(i)?i:function(){},r=Si.isFunction(r)?r:function(){};var u=!1!==o.async;o.timeout&&u&&(s.timeout=o.timeout),s.onload=function(){s.status>=200&&s.status<300?i(s.response):r(new Error("XHR error: server responded with status "+s.status+" "+s.statusText),s.status)},s.onerror=function(){r(new Error("XHR error"))},s.open(n,t,u),s.withCredentials=!0,s.setRequestHeader("Content-type","application/json"),s.send(e)}},Ci={},Mi=function(t){Ci[t]&&(clearTimeout(Ci[t]),Ci[t]=null)},Pi={_utClearSessions:function(){for(var t in Ci)Mi(t)},lottery:function(t){return Math.random()<t},sessionSampled:function(t,n,e){var i;if(Ci[t])i=!0;else{var r=Pi.lottery(n);r&&e>0&&(Ci[t]=setTimeout(Mi.bind(null,t),e)),i=r}return i},isSampledIn:function(t,n,e,i,r){return n||Pi.sessionSampled(t,e,i)||Pi.lottery(r)}},Di=Pi,ji="localStorage",Ui="sessionStorage",Fi=function(t){var n=null,e=!1;return function(){return t?n=t:(e||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),e=!0),n||(n={storage:{},getItem:function(t){return this.storage[t]},setItem:function(t,n){this.storage[t]=n},removeItem:function(t){delete this.storage[t]}})),n}};function Li(t){var n=null,e=t===ji;try{n="undefined"!=(e?typeof localStorage:typeof sessionStorage)?e?localStorage:sessionStorage:null}catch(i){n=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+i)}return n}var Vi={_utDefaultStorageObject:function(t){return Li(t)},localStorageObject:Fi(Li(ji)),sessionStorageObject:Fi(Li(Ui)),saveObjectToStorage:function(t,n,e){var i=null;if(e)try{t.setItem(n,JSON.stringify(e)),i=e}catch(r){}else i=t.removeItem(n);return i},objectFromStorage:function(t,n){var e=null,i=t.getItem(n);if(i)try{e=JSON.parse(i)}catch(r){e=void 0}return e}},Hi={};Hi.backoff=di,Hi.config=Oi,Hi.cookies=Ni,Hi.delegatesInfo=mi,Hi.eventFields=ki,Hi.keyValue=Ri,Hi.network=xi,Hi.number=Ti,Hi.reflect=Si,Hi.sampling=Di,Hi.storage=Vi,Hi.string=Ii,Hi.optionValueFromStoreFrontHeader=function(t,n){for(var e=null,i="string"==typeof t?t.split(" "):[],r=Hi.string.endsWith(n,":")?n:n+":",o=0;!e&&o<i.length;++o)0===i[o].search(r)&&(e=i[o].slice(r.length));return e};var Ki=Hi,Bi={setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},globalScope:function(){return n}},qi={setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},localStorageObject:Ki.storage.localStorageObject,sessionStorageObject:Ki.storage.sessionStorageObject},Wi={flagArguments:{INCLUDE_CALL_STACK:new function(){},MIRROR_TO_SERVER:new function(){},SUPPRESS_CLIENT_OUTPUT:new function(){}},setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},execute:function(t,n,e){var i=t.levelStringToIntMap[n];if(t.level()!==t.NONE&&t.level()<=i){var r=Array.prototype.slice.call(e),o=Wi.nonFlagLogArguments(r),s=Wi.logOptions(t,i,r),u=s.includeCallStack?(new Error).stack:null,a=u?o.concat("\n"+u):o;if(t[n]._lastLog=a,s.mirrorToServer&&Wi.sendToServer(t,n,o,u),s.throwInsteadOfPrint)throw new Error(o.toString());s.suppressClientOutput||(console[n]?console[n].apply(console,a):console.log.apply(console,a))}},isFlagObject:function(t){return t&&t===Wi.flagArguments[t.constructor.name]},nonFlagLogArguments:function(t){return t.filter((function(t){return!Wi.isFlagObject(t)}))},logOptions:function(t,n,e){var i,r={};return e.forEach((function(t){Wi.isFlagObject(t)&&(i=Ki.string.snakeCaseToCamelCase(t.constructor.name),r[i]=!0)})),Ki.reflect.isFunction(t.mirrorToServerLevel)&&t.mirrorToServerLevel()!==t.NONE&&t.mirrorToServerLevel()<=n&&(r.mirrorToServer=!0),t.throwLevel()!==t.NONE&&t.throwLevel()<=n&&(r.throwInsteadOfPrint=!0),r},sendToServer:function(){}},Xi=Wi,Yi={MIN_LEVEL:0,NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,MAX_LEVEL:4,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}},$i={loggerName:"defaultLogger",level:Yi.INFO,throwLevel:Yi.NONE},Gi={},Ji=function(t){this._loggerName=t};Ji.loggerNamed=function(t){var n=Gi[t=t||$i.loggerName];return n||(n=new Ji(t),Gi[t]=n),n},Ji.level=function(){return $i.level},Ji.throwLevel=function(){return $i.throwLevel},Ki.reflect.extend(Ji.prototype,Yi),Ki.reflect.extend(Ji.prototype,Xi.flagArguments),Ji.prototype.setDelegate=function(t){return Ki.reflect.attachDelegate(this,t)},Ji.prototype.loggerName=function(){return this._loggerName},Ji.prototype.levelParameterAsInt=function(t){var n,e=null;return Ki.reflect.isString(t)?n=this.levelStringToIntMap[t.toLowerCase()]:Ki.reflect.isNumber(t)&&(n=t),n>=this.MIN_LEVEL&&n<=this.MAX_LEVEL&&(e=n),e},Ji.prototype.setLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._level=n)},Ji.prototype.setThrowLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._throwLevel=n)},Ji.prototype.level=function(){var t=this._level;return Ki.reflect.isNumber(t)?t:Ji.level()},Ji.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},Ji.prototype.throwLevel=function(){var t=this._throwLevel;return Ki.reflect.isNumber(t)?t:Ji.throwLevel()},Ji.prototype.debug=function(){Xi.execute(this,"debug",arguments)},Ji.prototype.info=function(){Xi.execute(this,"info",arguments)},Ji.prototype.warn=function(){Xi.execute(this,"warn",arguments)},Ji.prototype.error=function(){Xi.execute(this,"error",arguments)},Ji.prototype.lastLog=function(t){return this[t]?this[t]._lastLog:null};var zi=Ji;zi.utils=Xi;var Qi=zi,Zi=Qi.loggerNamed("mt-client-config"),tr={setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},makeAjaxRequest:Ki.network.makeAjaxRequest},nr={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},er={},ir=function(t,n,e){if(e){t.push(e);var i=e[n];i&&Ki.reflect.hasAnyKeys(i)&&t.push(i)}},rr=function(t){this._topic=t,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+nr.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+nr.compoundSeparator+this._topic};rr.createConfig=function(t,n,e,i){var r=rr.getConfig(t);return t&&"noTopicConfig"!==t&&!r._initCalled&&r.init(n,e,i),r},rr.getConfig=function(t){var n=er[t=t||"noTopicConfig"];return n||(n=new rr(t),er[t]=n),n},rr.cleanupConfig=function(t){if(t&&er[t]){var n=er[t];n.setCachedSource(),n.setDebugSource(),delete er[t]}},rr.defaultConfig=function(){return rr.getConfig()},rr.value=function(t,n){var e=n&&er[n]||rr.defaultConfig();return e.value.call(e,t)},rr.environment=qi,rr.logger=Zi,rr.network=tr,rr.prototype._defaults=function(){return nr},rr.prototype._setInitialized=function(t){this._initialized=t},rr.prototype._setInitCalled=function(t){this._initCalled=t},rr.prototype._setShowedDebugWarning=function(t){this._showedDebugWarning=t},rr.prototype._setShowedNoProvidedSourceWarning=function(t){this._showedNoProvidedSourceWarning=t},rr.prototype.setDelegate=function(t){return Ki.reflect.attachDelegate(this,t)},rr.prototype.topic=function(){return this._topic},rr.prototype.configHostname=function(){},rr.prototype.configUrl=function(){var t,n=this.configHostname();return t=n?"https://"+n+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?t+="/"+this.topic():rr.logger.error("config.configUrl(): Topic must be provided"),t},rr.prototype.sources=function(){},rr.prototype.value=function(t){var n,e=this.cachedSource(),i=this.serviceSource(),r=this.sources(),o=this.debugSource(),s=e||i||r||o;return r||i||t in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,rr.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),o&&(this._showedDebugWarning||(this._showedDebugWarning=!0,rr.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),Ki.reflect.isArray(r)||(r=[r]),n=0===t.indexOf("blacklisted")?s?[e,i,r,o]:[nr]:[nr,e,i,r,o],n=this.configSourcesWithOverrides(n,this.topic()),Ki.keyValue.valueForKeyPath.apply(Ki.keyValue,[t].concat(n))},rr.prototype.configSourcesWithOverrides=function(t,n){var e=t;if(t&&t.length&&n){e=[];for(var i=0;i<t.length;i++){var r=t[i];if(r)if(Ki.reflect.isArray(r)&&r.length){for(var o=[],s=0;s<r.length;s++)ir(o,n,r[s]);e.push(o)}else ir(e,n,r)}}return e},rr.prototype.setDebugSource=function(t){return this._debugSource=t||null,Ki.storage.saveObjectToStorage(rr.environment.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},rr.prototype.debugSource=function(){return this._debugSource||(this._debugSource=Ki.storage.objectFromStorage(rr.environment.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},rr.prototype.setCachedSource=function(t){return this._cachedSource=t||null,Ki.storage.saveObjectToStorage(rr.environment.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},rr.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=Ki.storage.objectFromStorage(rr.environment.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},rr.prototype.setServiceSource=function(t){return this._serviceSource=t,this._serviceSource},rr.prototype.serviceSource=function(){return this._serviceSource},rr.prototype.fetchConfig=function(t,n,e){e=e||function(){},Ki.backoff.exponentialBackoff(tr.makeAjaxRequest.bind(tr,t,"GET",null),(function(t){var i;try{t=JSON.parse(t),i=!0}catch(r){e.call(e,r)}i&&n&&n.call(n,t)}),e)},rr.prototype.init=function(t,n,e){if(!this._initCalled){this._initCalled=!0,n=n||function(){};var i=function(){this._initialized=!0,n.call(n)}.bind(this);if(t)this.setDelegate({sources:t}),i();else{this.setCachedSource(this.cachedSource());var r=this.configUrl(),o=function(t){this.setCachedSource(t),this.setServiceSource(t),i()}.bind(this);this.fetchConfig(r,o,e)}}},rr.prototype.initialize=function(t,n,e){return this.init.apply(this,Array.prototype.slice.call(arguments))},rr.prototype.initialized=function(){return this._initialized};var or=rr,sr=Qi.loggerNamed("mt-event-queue"),ur={setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},makeAjaxRequest:Ki.network.makeAjaxRequest},ar={AJAX:"ajax",AJAX_SYNCHRONOUS:"ajaxSynchronous",IMAGE:"image"},cr=Ki.reflect,fr=ar,lr={DEFAULT_REQUEST_TIMEOUT:1e4,EVENTS_KEY:"events",EVENT_DELIVERY_VERSION:"1.0",MAX_PERSISTENT_QUEUE_SIZE:100,RETRY_EXPONENT_BASE:2,SEND_METHOD:fr,URL_DELIVERY_VERSION:2,eventQueues:{},postIntervalEnabled:!0,enqueueEvent:function(t,n){var e=null;if(t&&n){lr.eventQueues=lr.eventQueues||{},lr.eventQueues[t]=lr.eventQueues[t]||{},lr.eventQueues[t][lr.EVENTS_KEY]=lr.eventQueues[t][lr.EVENTS_KEY]||[],lr.eventQueues[t][lr.EVENTS_KEY].push(n),e=n;var i=or.value("maxPersistentQueueSize",t)||lr.MAX_PERSISTENT_QUEUE_SIZE;lr.trimEventQueues(lr.eventQueues,i)}return e},trimEventQueues:function(t,n){var e=Object.keys(t);e.length&&e.forEach((function(e){var i=t[e][lr.EVENTS_KEY];i&&i.length&&i.length>n&&(sr.warn("eventQueue overflow, deleting LRU events: size is: "+i.length+" which is over max size: "+n),t[e][lr.EVENTS_KEY]=i.slice(-n))}))},resetTopicQueue:function(t){lr.eventQueues[t]&&(lr.eventQueues[t][lr.EVENTS_KEY]=null)},resetTopicRetryAttempts:function(t){lr.eventQueues[t]&&(lr.eventQueues[t].retryAttempts=0)},scheduleNextTopicRetryAttempt:function(t){if(lr.eventQueues[t]&&this.postIntervalEnabled){lr.eventQueues[t].retryAttempts=lr.eventQueues[t].retryAttempts||0,lr.eventQueues[t].retryAttempts++;var n=Math.pow(lr.RETRY_EXPONENT_BASE,lr.eventQueues[t].retryAttempts)*or.value("postFrequency",t);lr.resetTopicPostInterval(t),lr.setTopicPostInterval(t,n)}},sendEvents:function(t,n){for(var e in lr.eventQueues)lr.sendEventsForTopic(e,t,n)},sendEventsForTopic:function(t,n,e){var i=lr.eventQueues[t],r=or.value("testExponentialBackoff",t),o=or.value("metricsUrl",t),s=Ki.config.disabled.call(or);if(i&&o&&!s&&!r&&(!i.retryAttempts||!e))switch(lr.resetTopicPostInterval(t),lr.setTopicPostInterval(t,or.value("postFrequency",t)),n){case lr.SEND_METHOD.IMAGE:lr.sendEventsViaImage(t);break;case lr.SEND_METHOD.AJAX_SYNCHRONOUS:lr.sendEventsViaAjax(t,!1);break;case lr.SEND_METHOD.AJAX:default:lr.sendEventsViaAjax(t,!0)}r&&lr.scheduleNextTopicRetryAttempt(t)},sendEventsViaImage:function(t){if(lr.eventQueues[t]){var n=lr.metricsUrlForTopic(t),e=-1==n.indexOf("?")?"?":"&",i=n+e+"responseType=image",r=lr.eventQueues[t][lr.EVENTS_KEY];r&&r.length&&r.forEach((function(t){var n=lr.createQueryParams(t);if(n){var e=i+"&"+n;(new Image).src=e}})),lr.resetTopicQueue(t)}},createQueryParams:function(t){var n,e,i="";return Object.keys(t).forEach((function(r,o,s){e=cr.isString(n=t[r])?n:JSON.stringify(n),i+=r+"="+encodeURIComponent(e),o<s.length-1&&(i+="&")})),i.length?i:null},sendEventsViaAjax:function(t,n){if(lr.eventQueues[t]&&lr.eventQueues[t][lr.EVENTS_KEY]){var e=lr.enrichAndSerializeEvents(lr.eventQueues[t][lr.EVENTS_KEY]);if(e){var i=lr.metricsUrlForTopic(t),r=function(){lr.resetTopicQueue(t),lr.resetTopicRetryAttempts(t)},o=or.value("requestTimeout",t)||lr.DEFAULT_REQUEST_TIMEOUT;o=Math.min(o,or.value("postFrequency",t)),ur.makeAjaxRequest(i,"POST",e,r,(function(n,e){e>=400&&e<500?r():lr.scheduleNextTopicRetryAttempt(t)}),{async:n,timeout:o})}}},enrichAndSerializeEvents:function(t){var n=null;if(t&&t.length){var e={};e.deliveryVersion=lr.EVENT_DELIVERY_VERSION,e.postTime=Date.now(),e[lr.EVENTS_KEY]=t;try{n=JSON.stringify(e)}catch(i){sr.error("Error stringifying events as JSON: "+i)}}return n},metricsUrlForTopic:function(t){return or.value("metricsUrl",t)+"/"+lr.URL_DELIVERY_VERSION+"/"+t},setTopicPostInterval:function(t,n){lr.eventQueues[t]&&n&&this.postIntervalEnabled&&(this.resetTopicPostInterval(t),lr.eventQueues[t].postIntervalToken=Bi.globalScope().setInterval((function(){sr.debug("MetricsKit: triggering postIntervalTimer for "+t+" at "+(new Date).toString()),lr.sendEventsForTopic.call(lr,t)}),n))},resetTopicPostInterval:function(t){lr.eventQueues[t]&&(Bi.globalScope().clearInterval(lr.eventQueues[t].postIntervalToken),lr.eventQueues[t].postIntervalToken=null)},resetQueuePostIntervals:function(){for(var t in lr.eventQueues)lr.resetTopicPostInterval(t)},setQueuePostIntervals:function(){for(var t in lr.eventQueues){var n=lr.eventQueues[t][lr.EVENTS_KEY];n&&n.length&&lr.setTopicPostInterval(t,or.value("postFrequency",t))}}},hr={_objectContainsValue:function(t,n){var e=!1;for(var i in t){var r=t[i];if(t.hasOwnProperty(i)&&!cr.isFunction(r)&&r===n){e=!0;break}}return e},_utQueue:function(){return lr},setPostIntervalEnabled:function(t){lr.postIntervalEnabled=t,t?lr.setQueuePostIntervals():lr.resetQueuePostIntervals()},recordEvent:function(t,n,e){Ki.config.disabled.call(or)||(0===or.value("postFrequency",t)&&(e=!0),lr.enqueueEvent(t,n),e?lr.sendEvents(lr.SEND_METHOD.AJAX,!0):!lr.eventQueues[t].postIntervalToken&&lr.postIntervalEnabled&&lr.setTopicPostInterval(t,or.value("postFrequency",t)))},flushUnreportedEvents:function(t,n){var e;t?cr.isString(n)&&this._objectContainsValue(fr,n)?lr.sendEvents(n,!0):(e=navigator.userAgent,/iPad|iPhone|iPod/.test(e)&&-1==e.indexOf("IEMobile")?lr.sendEvents(lr.SEND_METHOD.AJAX_SYNCHRONOUS,!0):lr.sendEvents(lr.SEND_METHOD.IMAGE,!0)):lr.sendEvents(lr.SEND_METHOD.AJAX,!0)}},dr={environment:Bi,eventRecorder:{_utResetQueue:function(){for(var t in hr._utQueue().eventQueues)hr._utQueue().resetTopicPostInterval(t);hr._utQueue().eventQueues={}},SEND_METHOD:ar,setDelegate:function(t){return Ki.reflect.attachDelegate(this,t)},recordEvent:function(t,n,e){var i=null;return n&&!Ki.config.metricsDisabledOrBlacklistedEvent.call(or,n.eventType,t)&&(Ki.config.removeBlacklistedFields.call(or,n,t),hr.recordEvent(t,n,e),i=n),i},flushUnreportedEvents:function(t,n){hr.flushUnreportedEvents(t,n)},sendMethod:function(){return"javascript"}},logger:sr,network:ur,setEventQueuePostIntervalEnabled:function(t){hr.setPostIntervalEnabled(t)}},vr={mirrorToServerLevel:Qi.prototype.NONE,topic:""};Qi.setTopic=function(t){vr.topic=t},Qi.topic=function(){return vr.topic},Qi.mirrorToServerLevel=function(){return vr.mirrorToServerLevel},Qi.prototype.setTopic=function(t){this._topic=t},Qi.prototype.topic=function(){var t=this._topic||Qi.topic();return t||console.error("LoggerKit: topic must be set in order to mirror log events to the server. Example: loggerKit.setTopic('my_figaro_topic');"),t},Qi.prototype.setMirrorToServerLevel=function(t){var n=this.levelParameterAsInt(t);null!==n&&(this._mirrorToServerLevel=n)},Qi.prototype.mirrorToServerLevel=function(){var t=this._mirrorToServerLevel;return Ki.reflect.isNumber(t)?t:Qi.mirrorToServerLevel()};var pr=Qi;Qi.eventRecorder=dr.eventRecorder;var gr={eventType:"log",eventVersion:"4"};pr.utils.setDelegate({sendToServer:function(t,n,e,i){var r=t.topic(),o=function(t,n,e,i){var r=null,o=e&&e.length;if(n&&(o||i)){if(Ki.reflect.extend(r={},gr),r.eventTime=Date.now(),r.level=n,r.loggerName=t.loggerName(),i&&(r.callstack=i),o){try{r.arguments=JSON.stringify(e)}catch(s){t.error("Error stringifying arguments as JSON: "+s)}"string"==typeof e[0]?r.message=e[0]:"object"==typeof e[0]&&1===e.length&&(r=Ki.reflect.extend({},e[0],r))}}else console.error("LoggerKit: at least one argument or the INCLUDE_CALL_STACK flag is required in order to mirror to server");return r}(t,n,e,i),s=null;return r&&o&&(s=Qi.eventRecorder.recordEvent(r,o)),s}});var yr=pr.loggerNamed("mt-vpafkit"),mr={environment:Qe,eventRecorder:ui,logger:yr},br={ACTION_TYPE:"actionType",CLIENT_EVENT_ID:"clientEventId",CONNECTION:"connection",CONSUMER_ID:"consumerId",CONSUMER_NS:"consumerNs",EVENT_TYPE:"eventType",EVENT_VERSION:"eventVersion",IS_OFFLINE:"isOffline",SCREEN_HEIGHT:"screenHeight",SCREEN_WIDTH:"screenWidth",START_REASON_TYPE:"startReasonType",STOP_REASON_TYPE:"stopReasonType",STOREFRONT_COUNTRY_CODE:"storeFrontCountryCode",VIDEO_VIEWPORT_HEIGHT:"videoViewportHeight",VIDEO_VIEWPORT_WIDTH:"videoViewportWidth"},Er={TYPE:{MANUAL:"manual",AUTOMATIC:"automatic",UNKNOWN:"unknown"},PLAY_START_REASON:{PLAY:"play",UNPAUSE:"unpause",NEXT:"next",PREVIOUS:"previous",SEEK:"seek",TRANSITION:"transition",INTERRUPTION:"interruption",FOREGROUND:"foreground",FOCUS:"focus",BUFFERING:"buffering",UNKNOWN:"unknown"},PLAY_START_REASON_TYPE:{SKIP_INTRO:"skipIntro"},PLAY_STOP_REASON:{COMPLETE:"complete",TRANSITION:"transition",PLAY_OTHER:"playOther",PAUSE:"pause",SEEK:"seek",NEXT:"next",INTERRUPTION:"interruption",BACKGROUND:"background",EXIT:"exit",INACTIVITY:"inactivity",BUFFERING:"buffering",ERROR:"error",FAILURE:"failure",CLOSE_PLAYER:"closePlayer",UNKNOWN:"unknown"},PLAY_STOP_REASON_TYPE:{SKIP_INTRO:"skipIntro"},SEEK_START_REASON:{NEXT:"next",PREVIOUS:"previous",LOCATION:"location",INTERVAL:"interval",PLAYHEAD:"playhead",SCRUB:"scrub",SKIP_INTRO:"skipIntro",UNKNOWN:"unknown"},SEEK_STOP_REASON:{NEXT:"next",PREVIOUS:"previous",LOCATION:"location",INTERVAL:"interval",PLAYHEAD:"playhead",SCRUB:"scrub",SKIP_INTRO:"skipIntro",UNKNOWN:"unknown"}},Sr={ACTIVITY_TYPE:{PLAY:"play",SEEK:"seek"},ACTION_TYPE:{START:"start",STOP:"stop"},EVENT_TYPE:{PLAY_ACTIVITY:"playActivity",SEEK_ACTIVITY:"seekActivity"}},Tr={INCLUDES_START_POSITIONS:"includesStartPositions",INCLUDES_END_POSITIONS:"includesEndPositions"},Ar=Ye.Base,Or=br,wr=function(){Ar.apply(this,arguments)};(wr.prototype=new Ar).constructor=wr,wr.prototype.environment=function(){return mr.environment},wr.prototype.eventRecorder=function(){return mr.eventRecorder},wr.prototype.knownFields=function(){return[Or.ACTION_TYPE,"app","appVersion","baseVersion",Or.CLIENT_EVENT_ID,Or.CONNECTION,"clientId","dsId","eventTime",Or.EVENT_TYPE,Or.EVENT_VERSION,"hardwareBrand","hardwareModel","hardwareFamily",Or.IS_OFFLINE,"os","osLanguages","osVersion","osBuildNumber","resourceRevNum",Or.SCREEN_HEIGHT,Or.SCREEN_WIDTH,Or.STOREFRONT_COUNTRY_CODE,"storeFrontHeader","timezoneOffset","userAgent",Or.VIDEO_VIEWPORT_HEIGHT,Or.VIDEO_VIEWPORT_WIDTH,"xpPostFrequency","xpSendMethod"]},wr.prototype.eventVersion=function(t){return t&&Or.EVENT_VERSION in t?t[Or.EVENT_VERSION]:null},wr.prototype.clientEventId=function(t){var n=t&&t[Or.CLIENT_EVENT_ID];return n||(On.string.cryptoRandomBase62String&&(n=On.string.cryptoRandomBase62String(!0)),n||(n=On.string.uuid())),n},wr.prototype.consumerId=function(t){var n=Or.CONSUMER_ID;return t&&n in t?t[n]:this.environment().consumerId()},wr.prototype.consumerNs=function(t){var n=Or.CONSUMER_NS;return t&&n in t?t[n]:this.environment().consumerNs()},wr.prototype.isOffline=function(t){return t&&Or.IS_OFFLINE in t?t[Or.IS_OFFLINE]:this.environment().isOffline()},wr.prototype.videoViewportHeight=function(t){return t&&Or.VIDEO_VIEWPORT_HEIGHT in t?t[Or.VIDEO_VIEWPORT_HEIGHT]:this.environment().videoViewportHeight()},wr.prototype.videoViewportWidth=function(t){return t&&Or.VIDEO_VIEWPORT_WIDTH in t?t[Or.VIDEO_VIEWPORT_WIDTH]:this.environment().videoViewportWidth()};var Ir=new wr((function(){return Kn()}));Ir.metricsData=function(){return Ir.processMetricsData.apply(Ir,[null].concat(Array.prototype.slice.call(arguments)))},Ir.processMetricsData=function(t){var n=null;if(!Hn.metricsDisabledOrBlacklistedEvent(t,Kn())){var e=Array.prototype.slice.call(arguments,1);if(this!==Ir){var i=Ir.metricsData.apply(Ir,e);e=[i].concat(e)}n=On.eventFields.processMetricsData(this,this.knownFields(),!0,e)}return Hn.removeBlacklistedFields(n,Kn()),n};var _r=Ir,Nr=br,Rr=function(t,n){this._defaultEventType=t,this._reasonConstants=n};On.reflect.extend(Rr,Sr),Object.defineProperties(Rr.prototype,{TYPE:{get:function(){return Er.TYPE}},REASON:{get:function(){return this._reasonConstants}}}),Rr.prototype.setDelegate=function(t){return On.reflect.attachDelegate(this,t)},Rr.prototype.knownFields=function(){return[Nr.ACTION_TYPE,Nr.EVENT_TYPE,Nr.EVENT_VERSION]},Rr.prototype.eventType=function(){return this._defaultEventType},Rr.prototype.eventVersion=function(t){var n=_r.eventVersion(t);return null!==n?n:1},Rr.prototype.actionType=function(){return this._defaultActionType};var kr=Rr,xr=function(){kr.apply(this,arguments),this._defaultActionType=kr.ACTION_TYPE.START};(xr.prototype=new kr).constructor=xr,xr.prototype.metricsData=function(t,n,e,i){var r=this.eventType(),o={position:t,overallPosition:n,startType:e,startReason:i},s=Array.prototype.slice.call(arguments,4);return _r.processMetricsData.apply(this,[r,o].concat(s))};var Cr=xr,Mr=function(){kr.apply(this,arguments),this._defaultActionType=kr.ACTION_TYPE.STOP};(Mr.prototype=new kr).constructor=Mr,Mr.prototype.metricsData=function(t,n,e,i,r){var o=this.eventType(),s={position:t,overallPosition:n,stopType:e,stopReason:i,startPosition:(r=r||{}).position,startOverallPosition:r.overallPosition,startTime:r.eventTime,startType:r.startType,startReason:r.startReason,startReasonType:r.startReasonType};o===kr.EVENT_TYPE.SEEK_ACTIVITY&&(s.startAssetId=r.assetId);var u=Array.prototype.slice.call(arguments,5);return _r.processMetricsData.apply(this,[o,s].concat(u))};var Pr=Mr,Dr={base:_r,playStart:new Cr(kr.EVENT_TYPE.PLAY_ACTIVITY,Er.PLAY_START_REASON),playStop:new Pr(kr.EVENT_TYPE.PLAY_ACTIVITY,Er.PLAY_STOP_REASON),seekStart:new Cr(kr.EVENT_TYPE.SEEK_ACTIVITY,Er.SEEK_START_REASON),seekStop:new Pr(kr.EVENT_TYPE.SEEK_ACTIVITY,Er.SEEK_STOP_REASON)},jr=function(){};jr.prototype.RANGE_OPTIONS=Tr,Object.defineProperties(jr.prototype,{eventData:{get:function(){}}}),jr.prototype.getItem=function(){},jr.prototype.getItems=function(){};var Ur=jr,Fr=mr.logger,Lr=function(t,n){this._date=new Date,this._position=n,this._validatePlaybackRate(t),this._playbackRate=t};Object.defineProperties(Lr.prototype,{playbackRate:{get:function(){return this._playbackRate}}}),Lr.prototype.update=function(t,n){this._date=new Date,this._position=n,this._validatePlaybackRate(t),this._playbackRate=t},Lr.prototype.estimatedTime=function(t){var n;On.reflect.isInteger(t)?n=t:(Fr.error("VPAFKit error: position should be an integer"),n=Math.round(t));var e=(n-this._position)/(0==this.playbackRate?1:this.playbackRate);return this._date.getTime()+Math.round(e)},Lr.prototype._validatePlaybackRate=function(t){0==t&&Fr.error("VPAFKit error: playbackRate should not be zero.")};var Vr=Lr,Hr=function(t){this._activityType=t,this._startMetricsData=null,this._isStopped=!1};Hr.ACTIVITY_TYPE=Sr.ACTIVITY_TYPE,Object.defineProperties(Hr.prototype,{isStopped:{get:function(){return this._isStopped}},type:{get:function(){return this._activityType}},startOverallPosition:{get:function(){return this._startMetricsData?this._startMetricsData.overallPosition:null}}}),On.reflect.extend(Hr.prototype,Er),Hr.prototype.started=function(t,n,e,i){var r=this._startEventHandler();r&&(this._startMetricsData=r.metricsData.apply(r,arguments),this.type!=Hr.ACTIVITY_TYPE.SEEK&&mr.eventRecorder.recordEvent(Kn(),this._startMetricsData))},Hr.prototype.stopped=function(t,n,e,i){var r=this._stopEventHandler();if(r){this._isStopped=!0;var o=[t,n,e,i,this._startMetricsData].concat(Array.prototype.slice.call(arguments,4)),s=r.metricsData.apply(r,o);mr.eventRecorder.recordEvent(Kn(),s)}},Hr.prototype._startEventHandler=function(){var t;switch(this.type){case Hr.ACTIVITY_TYPE.PLAY:t=Dr.playStart;break;case Hr.ACTIVITY_TYPE.SEEK:t=Dr.seekStart}return t},Hr.prototype._stopEventHandler=function(){var t;switch(this.type){case Hr.ACTIVITY_TYPE.PLAY:t=Dr.playStop;break;case Hr.ACTIVITY_TYPE.SEEK:t=Dr.seekStop}return t};var Kr=mr.logger,Br=$e.MetricsData,qr={MediaActivity:Hr}.MediaActivity,Wr=Tr.INCLUDES_START_POSITIONS,Xr=Tr.INCLUDES_END_POSITIONS,Yr=function(t){Br.apply(this,arguments),this._playlist=t,this._playActivity=null,this._playStartPlaylistItem=null,this._seekActivity=null,this._timeTracker=null,this._shouldGenerateTransitions=!0};(Yr.prototype=new Br).constructor=Yr,On.reflect.extend(Yr.prototype,Er),Object.defineProperties(Yr.prototype,{shouldGenerateTransitions:{get:function(){return this._shouldGenerateTransitions},set:function(t){this._shouldGenerateTransitions=t}}}),Yr.prototype.setDelegate=function(t){return On.reflect.attachDelegate(this,t)},Yr.prototype.playStarted=function(t,n,e){return this.playStartedWithPlaybackRate.apply(this,[1].concat(Array.prototype.slice.call(arguments)))},Yr.prototype.playStartedWithPlaybackRate=function(t,n,e,i){if(this._hasUnstoppedActivity(this._playActivity))this._error("inconsistent state: did you forget to call playStopped?");else{var r=this._playlistItem(n,Wr);r&&(this._playStarted.apply(this,[r].concat(Array.prototype.slice.call(arguments,1))),this.shouldGenerateTransitions&&(this._timeTracker=new Vr(t,n)))}},Yr.prototype.playStopped=function(t,n,e){this._generatePlaylistTransitionsIfNecessary(t),this._hasUnstoppedActivity(this._playActivity)?this._playStopped.apply(this,Array.prototype.slice.call(arguments)):this._error("inconsistent state: did you forget to call playStarted?"),this._playStartPlaylistItem=null,this._timeTracker=null},Yr.prototype.playTransitioned=function(t){this.playStopped.apply(this,[t,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1))),this.playStarted.apply(this,[t,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1)))},Yr.prototype.seekStarted=function(t,n,e){if(this._hasUnstoppedActivity(this._seekActivity))this._error("inconsistent state: did you forget to call seekStopped?");else{var i=this._playlistItem(t,Wr);if(i){var r=this._activityArguments.apply(this,[i].concat(Array.prototype.slice.call(arguments)));this._seekActivity=new qr(qr.ACTIVITY_TYPE.SEEK),this._seekActivity.started.apply(this._seekActivity,r)}}},Yr.prototype.seekStopped=function(t,n,e){var i=this._playlistItem(t,Xr);if(i&&this._hasUnstoppedActivity(this._seekActivity)){var r=this._activityArguments.apply(this,[i].concat(Array.prototype.slice.call(arguments)));this._seekActivity.stopped.apply(this._seekActivity,r)}else this._error("inconsistent state: did you forget to call seekStarted?")},Yr.prototype.synchronize=function(t,n){if(this.shouldGenerateTransitions){var e=t>0,i=this._hasUnstoppedActivity(this._playActivity);i&&e?(this._generatePlaylistTransitionsIfNecessary(n),this._timeTracker.update(t,n)):i&&!e?this._error("inconsistent state: did you forget to call playStopped?"):!i&&e&&this._error("inconsistent state: did you forget to call playStarted?")}},Yr.prototype._playStarted=function(t,n,e,i){var r=this._activityArguments.apply(this,[t].concat(Array.prototype.slice.call(arguments,1)));this._playStartPlaylistItem=t,this._playActivity=new qr(qr.ACTIVITY_TYPE.PLAY),this._playActivity.started.apply(this._playActivity,r)},Yr.prototype._playStopped=function(t,n,e){var i=this._playStartPlaylistItem,r=this._activityArguments.apply(this,[i].concat(Array.prototype.slice.call(arguments)));this._playActivity.stopped.apply(this._playActivity,r)},Yr.prototype._playlistItem=function(t,n){var e;return this._playlist&&On.reflect.isFunction(this._playlist.getItem)&&(e=this._playlist.getItem(t,n)),e||this._error("unable to get item from playlist"),e},Yr.prototype._playlistItems=function(t,n){var e=[];return this._playlist&&On.reflect.isFunction(this._playlist.getItems)?e=this._playlist.getItems(t,n):this._error("unable to get items from playlist"),e},Yr.prototype._relativePosition=function(t,n){var e;return(n=n||this._playlistItem(t))&&On.reflect.isNumber(n.startOverallPosition)&&(e=t-n.startOverallPosition+(n.startPosition||0)),e},Yr.prototype._combineEventData=function(t,n){var e=this._playlist?this._playlist.eventData:null,i=t?t.eventData:null,r=[];return e&&r.push(e),i&&r.push(i),this._eventData&&r.push(this._eventData),n&&(r=r.concat(n)),r},Yr.prototype._activityArguments=function(t,n,e,i){var r=this._relativePosition(n,t),o=this._combineEventData(t,Array.prototype.slice.call(arguments,4)),s=[r,n,e,i].concat(o);return s},Yr.prototype._generatePlaylistTransitionsIfNecessary=function(t){if(this.shouldGenerateTransitions&&this._hasUnstoppedActivity(this._playActivity)){var n,e,i,r=this._playActivity.startOverallPosition||0,o=this._playlistItems(r,t);this._playlist._returnsOrderedItems||o.sort(this._playlistItemComparator);for(var s=0;s+1<o.length;s++)if(!((n=(e=o[s+1]).startOverallPosition)<=r)){if(n>=t)break;i={eventTime:this._timeTracker?this._timeTracker.estimatedTime(n):null},this._playStopped(n,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION,i),this._playStarted(e,n,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION,i)}}},Yr.prototype._hasUnstoppedActivity=function(t){return t&&!t.isStopped},Yr.prototype._error=function(t){Kr.error(this.constructor.name+" error: "+t)},Yr.prototype._playlistItemComparator=function(t,n){return t.startOverallPosition==n.startOverallPosition?0:t.startOverallPosition<n.startOverallPosition?-1:1};var $r=Yr,Gr=$e.MetricsData,Jr=function(t){Gr.apply(this,arguments),this._startOverallPosition=t,this._startPosition=0};(Jr.prototype=new Gr).constructor=Jr,Object.defineProperties(Jr.prototype,{startOverallPosition:{get:function(){return this._startOverallPosition}},startPosition:{get:function(){return this._startPosition},set:function(t){this._startPosition=t}},eventData:{get:function(){return this._eventData}}});var zr={Tracker:$r,MediaPlaylist:Ur,MediaPlaylistItem:Jr,TimeTracker:Vr},Qr=zr.MediaPlaylistItem,Zr=function(t,n){Qr.apply(this,arguments),this._duration=n};(Zr.prototype=new Qr).constructor=Zr,Object.defineProperties(Zr.prototype,{duration:{get:function(){return this._duration}},endOverallPosition:{get:function(){return this.startOverallPosition+this.duration}}}),Zr.prototype.containsOverallPosition=function(t){return this.startOverallPosition<=t&&this.endOverallPosition>t};var to=Zr,no=zr.MediaPlaylistItem,eo=zr.MediaPlaylist,io=On.reflect,ro=function(t){eo.apply(this,arguments),this._startPosition=t,this._mainFeatureMetricsData=io.copyKeysAndValues.apply(io,[!1,!1,!1,null].concat(Array.prototype.slice.call(arguments,1))),this._rollItems=[]};(ro.prototype=new eo).constructor=ro,ro.prototype.setDelegate=function(t){return On.reflect.attachDelegate(this,t)},ro.prototype.addRollInfoItems=function(t){t&&t.length&&t.forEach((function(t){this.addRollInfoItem(t)}),this)},ro.prototype.addRollInfoItem=function(t){t&&this.addRollItem(1e3*t.start,1e3*t.duration,t.metricsData)},ro.prototype.addRollItem=function(t,n){var e=new to(t,n);e.updateData.apply(e,Array.prototype.slice.call(arguments,2)),this._addRollItem(e)},ro.prototype.updateMainFeatureMetricsData=function(){On.reflect.extend.apply(On.reflect,[this._mainFeatureMetricsData].concat(Array.prototype.slice.call(arguments)))},ro.prototype.getItem=function(t,n){var e,i=this._indexOfLastRollItemWithStartBeforePosition(t);if(io.isInteger(i)){for(;n!=this.RANGE_OPTIONS.INCLUDES_START_POSITIONS&&this._rollItems[i].startOverallPosition==t&&i>0;)i--;(e=this._rollItems[i]).containsOverallPosition(t)||n==this.RANGE_OPTIONS.INCLUDES_END_POSITIONS&&e.endOverallPosition==t||(e=this._mainFeatureItemWithStartOverallPosition(e.endOverallPosition))}else e=this._mainFeatureItemWithStartOverallPosition(this._startPosition);return e},ro.prototype.getItems=function(t,n){var e=[];if(this._rollItems.length){var i=this._indexOfLastRollItemWithStartBeforePosition(t);for(io.isInteger(i)||(e.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition)),i=0);i<this._rollItems.length;){var r=this._rollItems[i];if(r.startOverallPosition>n)break;if(r.endOverallPosition>=t&&e.push(r),i++,r.endOverallPosition<n)if(i<this._rollItems.length){var o=this._rollItems[i];o.startOverallPosition&&o.startOverallPosition>r.endOverallPosition&&e.push(this._mainFeatureItemWithStartOverallPosition(r.endOverallPosition))}else e.push(this._mainFeatureItemWithStartOverallPosition(r.endOverallPosition))}}else e.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition));return e},ro.prototype._addRollItem=function(t){if(t){var n=this._insertionIndexForItemWithPosition(t.startOverallPosition);this._rollItems.splice(n,0,t)}},ro.prototype._indexOfLastRollItemWithStartBeforePosition=function(t){var n,e=this._rollItems[0];return e&&io.isInteger(t)&&e.startOverallPosition<=t&&(n=this._insertionIndexForItemWithPosition(t)-1),n},ro.prototype._insertionIndexForItemWithPosition=function(t){for(var n=0,e=this._rollItems.length;n<e;){var i=Math.floor((n+e)/2);this._rollItems[i].startOverallPosition>t?e=i:n=i+1}return n},ro.prototype._mainFeatureItemWithStartOverallPosition=function(t){var n=new no(t);return n.startPosition=this._featurePlayheadProgress(t),n.updateData(this._mainFeatureMetricsData),n},ro.prototype._featurePlayheadProgress=function(t){var n,e=this._indexOfLastRollItemWithStartBeforePosition(t=t||0),i=this._startPosition||0;On.reflect.isInteger(e)||(e=-1);for(var r=e;r>=0;r--)n=this._rollItems[r],i+=0===r?n.startOverallPosition:n.startOverallPosition-this._rollItems[r-1].endOverallPosition;return i};var oo=ro,so=function(){};Object.defineProperties(so.prototype,{start:{get:function(){}},duration:{get:function(){}},metricsData:{get:function(){}}});var uo,ao=oo,co={createTracker:function(t){var n=new $r(t);return n.updateData.apply(n,Array.prototype.slice.call(arguments,1)),n},createHLSVideoPlaylist:function(t){var n=new ao(t);return n.updateMainFeatureMetricsData.apply(n,Array.prototype.slice.call(arguments,1)),n}},fo=function(t){On.reflect.attachMethods(t,On.config,t)},lo={_utReset:function(){lo.config=Hn.defaultConfig(),uo=!1},system:mr,config:Hn.defaultConfig(),eventHandlers:Dr,createTracker:function(t){return yr.warn("mt-vpafkit: vpafkit.createTracker() is deprecated and will be removed in a future release. Use vpafkit.mediaActivity.createTracker() instead"),this.mediaActivityTracker.createTracker.apply(this.mediaActivityTracker,arguments)},mediaActivityTracker:co,utils:qn,init:function(t,n,e,i,r){if(!uo){uo=!0,e&&(On.reflect.setDelegates(Dr,e),On.reflect.setDelegates(mr,e)),Bn(t);var o=Hn.getConfig(t);fo(o),On.reflect.copyDelegatedFunctions(lo.config,o),o.init(n,i,r),lo.config=o}}};fo(Hn.defaultConfig());var ho=lo,vo=t((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertAudioCodecToFormat=void 0;const e={"ac-3":"AC3","mp4a.a5":"AC3",alac:"Apple Lossless","ec-3":"EC3","mp4a.a6":"EC3",flac:"Free Lossless","mp4a.40.2":"AAC","mp4a.40.5":"AAC","mp4a.40.29":"AAC","mp4a.40.34":"MP3","mp4a.40.42":"AAC"},i=/^[0-9]+\/JOC$/;n.convertAudioCodecToFormat=(t,n)=>{var r,o;const s=null!==(r=null==t?void 0:t.toLowerCase())&&void 0!==r?r:"";return((t,n)=>"EC3"===e[t]&&(t=>i.test(t))(n))(s,n)?"Atmos":null!==(o=e[s])&&void 0!==o?o:t}})),po=t((function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertToVideoColorRange=void 0;const e=["dvh1.05.01","dvhe.05.06"],i={PQ:"HDR",HLG:"HDR",SDH:"SDH"};n.convertToVideoColorRange=(t,n)=>(t=>-1!==e.indexOf(t))(t)?"DolbyVision":(t=>{var n;return null!==(n=i[t])&&void 0!==n?n:t})(n)}));const go={consumerNamespace:"TV",app:"com.apple.tv",appName:"web-tv-player",appVersion:"1.0",topic:"xp_amp_tv_main_vpaf"};class yo{constructor(){this._hasPlayed=!1,this._isBuffering=!1,this._isEnabled=!1,this._isPlaying=!1,this._vpafInited=!1,ho.config.setDelegate({configHostname:()=>"daf.xp.apple.com"}),this._eventsToCallbacks={ended:this._trackEnded.bind(this),error:this._trackError.bind(this),loadstart:this._trackBuffering.bind(this),pause:this._trackPaused.bind(this),play:this._trackPlay.bind(this),playing:this._trackPlayAutomatic.bind(this),waiting:this._trackBuffering.bind(this)},this._synchronize=this._synchronize.bind(this)}get _trackType(){return this.userInitiated?this._tracker.TYPE.MANUAL:this._tracker.TYPE.AUTOMATIC}async initialize(t,n,e){if(this._resetElement(),this._element=t,this._videoData=n,this._isEnabled=this._shouldTrack(n,e),!this._isEnabled)return void this.reset();const i=Object.assign(Object.assign({},go),e);return this._config=i,new Promise(((t,n)=>{const e=()=>(ho.system.environment.setDelegate({app:()=>i.app,appVersion:()=>i.appVersion,consumerId:()=>i.consumerId,consumerNs:()=>i.consumerNamespace,isOffline:()=>!1,delegateApp:()=>i.appName,osLanguages:()=>s.getLanguages(),resourceRevNum:()=>i.appBuildVersion,storeFrontCountryCode:()=>i.storeFrontCountryCode}),this._vpafInited=!0,this._createTracker(),this._addMediaElementListeners(),t(this));if(this._vpafInited||ho.config.topic()===this._config.topic)return e();ho.init(this._config.topic,null,{environment:Ht,eventRecorder:Kt},e,(t=>{n(t)}))}))}reset(){this._resetElement(),this._tracker=void 0}updateAudioCodec(t,n){this._audioCodec=vo.convertAudioCodecToFormat(t,n),this._tracker&&this._tracker.updateData({audioFormat:this._audioCodec})}updateLanguage(t){this._language=t,this._tracker&&this._tracker.updateData({audioLocale:this._language})}updateVideoColorRange(t,n){this._videoColorRange=po.convertToVideoColorRange(t,n),this._tracker&&this._tracker.updateData({videoColorRange:this._videoColorRange})}_addMediaElementListeners(){void 0!==this._element&&this._isEnabled&&Object.keys(this._eventsToCallbacks).forEach((t=>{this._element.addEventListener(t,this._eventsToCallbacks[t])}))}_createTracker(){if(!this._isEnabled)return;const t=this._getMainFeatureData(),n=1e3*this._videoData.duration,e=ho.mediaActivityTracker.createHLSVideoPlaylist(0,t),i={canonicalId:this._videoData.id,overallLength:n,featureExternalId:this._videoData.externalId,url:this._videoData.assets.hlsUrl,featureAssetId:this._videoData.assets.assetAdamId},r=this._videoData.vpafMetrics,o=this._getAdditionalTrackingData();return o.overallLength=n,this._tracker=ho.mediaActivityTracker.createTracker(e,i,{},r,o),this._lastMethod=void 0,this._tracker}_getAdditionalTrackingData(){return{programmingType:"videoOnDemand",downloadState:"streaming",videoViewportHeight:this._element.clientHeight,videoViewportWidth:this._element.clientWidth,playbackFocus:"foreground"}}_getCurrentPosition(){const t=isNaN(this._element.currentTime)?0:this._element.currentTime;return Math.round(1e3*t)}_getMainFeatureData(){let t=this._language;void 0===t&&this._videoData.primaryLocale&&void 0!==this._videoData.primaryLocale.locale&&(t=this._videoData.primaryLocale.locale);const n={assetPlacement:"feature",assetId:this._videoData.assets?this._videoData.assets.assetAdamId:void 0};return void 0!==t&&(n.audioLocale=t),void 0!==this._audioCodec&&(n.audioFormat=this._audioCodec),void 0!==this._videoColorRange&&(n.videoColorRange=this._videoColorRange),n}_resetElement(){this._resetState(),void 0!==this._element&&Object.keys(this._eventsToCallbacks).forEach((t=>this._element.removeEventListener(t,this._eventsToCallbacks[t])))}_resetState(){this._isBuffering=!1,this._hasPlayed=!1,this._isPlaying=!1,this._stopSynchronizing()}_shouldTrack(t,n){return n&&"string"!=typeof(e=t)&&void 0!==e.vpafMetrics;var e}_startSynchronizing(){void 0===this._synchronizeTimeoutId&&(this._synchronizeTimeoutId=setInterval(this._synchronize,6e4))}_stopSynchronizing(){void 0!==this._synchronizeTimeoutId&&(clearInterval(this._synchronizeTimeoutId),this._synchronizeTimeoutId=void 0)}_synchronize(){void 0!==this._tracker?this._tracker.synchronize(this._isPlaying?this._element.playbackRate:0,this._getCurrentPosition()):this._stopSynchronizing()}_trackBuffering(){this._isBuffering||(this._hasPlayed||this._trackPlay(),this._isBuffering=!0,this._isPlaying=!1,this._trackActivity("playStopped",this._tracker.TYPE.AUTOMATIC,this._tracker.PLAY_STOP_REASON.BUFFERING))}_trackEnded(){this._trackActivity("playStopped",this._tracker.TYPE.AUTOMATIC,this._tracker.PLAY_STOP_REASON.COMPLETE),this._resetState()}_trackError(){this._isPlaying&&(this._trackActivity("playStopped",this._tracker.TYPE.AUTOMATIC,this._tracker.PLAY_STOP_REASON.ERROR),this._isPlaying=!1),this._resetState()}_trackPaused(){this._isPlaying=this._isBuffering=!1,this._trackActivity("playStopped",this._trackType,this._tracker.PLAY_STOP_REASON.PAUSE)}_trackPlay(){this._trackPlayback(this._trackType),this._startSynchronizing()}_trackPlayAutomatic(){this._trackPlayback(this._tracker.TYPE.AUTOMATIC),this._startSynchronizing()}_trackPlayback(t){this._trackActivity("playStarted",t,this._isBuffering?this._tracker.PLAY_START_REASON.BUFFERING:this._tracker.PLAY_START_REASON.PLAY),this._hasPlayed=!0,this._isPlaying=!0,this._isBuffering=!1}_trackActivity(t,n,e){this._tracker&&t!==this._lastMethod&&(this._lastMethod=t,this._tracker[t](this._getCurrentPosition(),n,e))}}const mo={emit:()=>{}};class bo{constructor(t=mo,n=mo){this._readyEmitter=t,this._errorEmitter=n,this.shouldHideTextTracks=!0,this.isUsingHlsJs=!1,this._channelsByGroup={},this._userInitiated=!1,this._hasHandledCanPlay=!1,this._handleCanPlay=this._handleCanPlay.bind(this),this._handlePlayEnded=this._handlePlayEnded.bind(this),this._handleError=this._handleError.bind(this),this._handleManifestParsed=this._handleManifestParsed.bind(this),this._handleAudioTracksUpdated=this._handleAudioTracksUpdated.bind(this),this._handleLevelSwitched=this._handleLevelSwitched.bind(this)}get _preferredLanguages(){var t;return null!==(t=this._languages)&&void 0!==t?t:[]}async initialize(t,n,e=[],i){if(window.hlsSession)return;const r=(t=>{if(void 0!==t)return"string"==typeof t?t:void 0!==t.assets&&void 0!==t.assets.hlsUrl?t.assets.hlsUrl:void 0!==t.url?t.url:void 0})(n);if(void 0!==n&&void 0!==r){if(this._hasHandledCanPlay=!1,this._removeElementListeners(),this._element=t,this._element.addEventListener("canplay",this._handleCanPlay),this._element.addEventListener("ended",this._handlePlayEnded),this._source=n,this._playbackUrl=r,this._languages=e,await this._addTracking(i),this.isUsingHlsJs=this._sourceIsHls(this._playbackUrl)&&!this._canPlayHls(),!this.isUsingHlsJs)return this._element.src=r,void this._readyEmitter.emit();await this._initializeHls()}}get userInitiated(){return this._userInitiated}set userInitiated(t){this._userInitiated=t,this._vpaf&&(this._vpaf.userInitiated=t)}destroy(){this._removeElementListeners(),this._destroyHlsSession(),this._element&&this._element.removeAttribute("src"),this._resetTracking()}pause(){this._element.pause()}async play(){if(!window.hlsSession)return this._element.play()}stop(){this.isUsingHlsJs&&void 0!==this.hlsSession&&this.hlsSession.stopLoad()}async _addTracking(t){this._vpaf||(this._vpaf=new yo),await this._vpaf.initialize(this._element,this._source,t),this._vpaf.userInitiated=this.userInitiated}_canPlayHls(){var t;return null===(t=window.WebKitMediaKeys)||void 0===t?void 0:t.isTypeSupported("com.apple.fps.1_0","video/mp4")}_destroyHlsSession(){void 0!==this.hlsSession&&(this.hlsSession.stopLoad(),this.hlsSession.detachMedia(),this.hlsSession.destroy(),this.hlsSession=void 0)}_handleCanPlay(){if(this._hideTextTracks(),this.isUsingHlsJs||this._hasHandledCanPlay)return;this._hasHandledCanPlay=!0;const t=this._element.audioTracks,n=void 0!==t?Array.from(t):[],e=Array.from(n).filter((t=>"main"===t.kind));if(0===e.length)return;const r=e.map((t=>t.language));let o=i(r,this._preferredLanguages);void 0===o&&(o=e[0].language),e.forEach((t=>{t.enabled=o===t.language})),this._trackLanguageSelection(o)}_handlePlayEnded(){this.isUsingHlsJs&&this._element.hasAttribute("data-loop")&&this._element.play().catch()}_handleError(t,n){this._errorEmitter.emit(n)}_handleLevelSwitched(t,n){var e,i;const{level:r}=n;if(!r)return;const o=null===(e=this._levels)||void 0===e?void 0:e.find((t=>t.persistentId===r));if(!o||(null===(i=this._currentLevel)||void 0===i?void 0:i.persistentId)===(null==o?void 0:o.persistentId))return;this._currentLevel=o;const s=this._channelsByGroup[o.audioGroupId];void 0!==o.audioCodec&&void 0!==s&&this._trackAudioCodec(o.audioCodec,s),void 0!==o.videoRange&&void 0!==o.videoCodec&&this._trackVideoColorRange(o.videoCodec,o.videoRange)}_handleAudioTracksUpdated(){const{audioMediaOptions:t}=this.hlsSession;if(!Array.isArray(t)||0===t.length)return void this._readyEmitter.emit();const n=t.map((t=>t.MediaSelectionOptionsExtendedLanguageTag)).filter(Boolean),e=i(n,this._preferredLanguages),r=void 0!==e?t.find((t=>t.MediaSelectionOptionsExtendedLanguageTag===e)):t[0];"number"==typeof r.MediaSelectionOptionsPersistentID&&(this.hlsSession.audioSelectedPersistentId=r.MediaSelectionOptionsPersistentID,this._trackLanguageSelection(r.MediaSelectionOptionsExtendedLanguageTag)),this._readyEmitter.emit()}_handleManifestParsed(t,n={}){const{levels:e,audioTracks:i}=n;this._levels=null!=e?e:[],this._channelsByGroup=i.reduce(((t,n)=>(t[n.groupId]=n.channels,t)),{})}_hideTextTracks(){if(this.shouldHideTextTracks)if(this.isUsingHlsJs)this.hlsSession.subtitleSelectedPersistentID=-1;else if(this._element.textTracks)for(let t=0;t<this._element.textTracks.length;t++){const n=this._element.textTracks[t];"showing"===n.mode&&(n.mode="hidden")}}async _initializeHls(){var t,n;if(r.isNodeEnvironment())return;const i=null===(t=window.MusicKit)||void 0===t?void 0:t.getHlsJsCdnConfig().hls;i||console.warn("MusicKit.getHlsJsCdnConfig does not exist, cannot load HLS");const o=null===(n=e.getLocalStorage())||void 0===n?void 0:n.getItem("mk-hlsjs-log-level"),s=null!=o;await l.loadScript(i);const{Hls:u}=window;if(!u||!u.isSupported())return void console.warn("This browser is not supported for this video type");const{LEVEL_SWITCHED:a,MANIFEST_PARSED:c,ERROR:f,AUDIO_TRACKS_UPDATED:h}=u.Events;this._destroyHlsSession();const d={debug:s,nativeControlsEnabled:!0,debugLevel:o,enablePerformanceLogging:s};this.configureCdnReporting(d),this.hlsSession=new u(d),this.hlsSession.loadSource(this._playbackUrl,{platformInfo:{},appData:{serviceName:"web-static-video"}}),this.hlsSession.attachMedia(this._element),this.hlsSession.once(c,this._handleManifestParsed),this.hlsSession.once(h,this._handleAudioTracksUpdated),this.hlsSession.on(f,this._handleError),this.hlsSession.on(a,this._handleLevelSwitched)}configureCdnReporting(t){const{Hls:n}=window,i=e.getLocalStorage().getItem("mk-block-report-cdn-server");if(n&&null!=i){const e=Object.assign({},n.DefaultConfig.fragLoadPolicy);e.default=Object.assign({},n.DefaultConfig.fragLoadPolicy.default),e.customURL=Object.assign({},n.DefaultConfig.fragLoadPolicy.customURL),e.default.reportCDNServer=!1,e.customURL.reportCDNServer=!1,t.fragLoadPolicy=e}}_removeElementListeners(){void 0!==this._element&&(this._element.removeEventListener("canplay",this._handleCanPlay),this._element.removeEventListener("ended",this._handlePlayEnded))}_resetTracking(){var t;null===(t=this._vpaf)||void 0===t||t.reset()}_sourceIsHls(t){const[n]=t.split("?");return n.endsWith("m3u8")}_trackAudioCodec(t,n){var e;null===(e=this._vpaf)||void 0===e||e.updateAudioCodec(t,n)}_trackLanguageSelection(t){var n;null===(n=this._vpaf)||void 0===n||n.updateLanguage(t)}_trackVideoColorRange(t,n){var e;null===(e=this._vpaf)||void 0===e||e.updateVideoColorRange(t,n)}}export{bo as H,h as g}